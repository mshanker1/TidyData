<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Tidy data</title>


<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
      a.sourceLine { display: inline-block; line-height: 1.25; }
  a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
  a.sourceLine:empty { height: 1.2em; }
  .sourceCode { overflow: visible; }
  code.sourceCode { white-space: pre; position: relative; }
  div.sourceCode { margin: 1em 0; }
  pre.sourceCode { margin: 0; }
  @media screen {
  div.sourceCode { overflow: auto; }
  }
  @media print {
  code.sourceCode { white-space: pre-wrap; }
  a.sourceLine { text-indent: -1em; padding-left: 1em; }
  }
  pre.numberSource a.sourceLine
    { position: relative; left: -4em; }
  pre.numberSource a.sourceLine::before
    { content: attr(title);
      position: relative; left: -1em; text-align: right; vertical-align: baseline;
      border: none; pointer-events: all; display: inline-block;
      -webkit-touch-callout: none; -webkit-user-select: none;
      -khtml-user-select: none; -moz-user-select: none;
      -ms-user-select: none; user-select: none;
      padding: 0 4px; width: 4em;
      color: #aaaaaa;
    }
  pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
  div.sourceCode
    {  }
  @media screen {
  a.sourceLine::before { text-decoration: underline; }
  }
  code span.al { color: #ff0000; font-weight: bold; } /* Alert */
  code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
  code span.at { color: #7d9029; } /* Attribute */
  code span.bn { color: #40a070; } /* BaseN */
  code span.bu { } /* BuiltIn */
  code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
  code span.ch { color: #4070a0; } /* Char */
  code span.cn { color: #880000; } /* Constant */
  code span.co { color: #60a0b0; font-style: italic; } /* Comment */
  code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
  code span.do { color: #ba2121; font-style: italic; } /* Documentation */
  code span.dt { color: #902000; } /* DataType */
  code span.dv { color: #40a070; } /* DecVal */
  code span.er { color: #ff0000; font-weight: bold; } /* Error */
  code span.ex { } /* Extension */
  code span.fl { color: #40a070; } /* Float */
  code span.fu { color: #06287e; } /* Function */
  code span.im { } /* Import */
  code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
  code span.kw { color: #007020; font-weight: bold; } /* Keyword */
  code span.op { color: #666666; } /* Operator */
  code span.ot { color: #007020; } /* Other */
  code span.pp { color: #bc7a00; } /* Preprocessor */
  code span.sc { color: #4070a0; } /* SpecialChar */
  code span.ss { color: #bb6688; } /* SpecialString */
  code span.st { color: #4070a0; } /* String */
  code span.va { color: #19177c; } /* Variable */
  code span.vs { color: #4070a0; } /* VerbatimString */
  code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    </style>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Tidy data</h1>



<p>(This is an informal and code heavy version of the full <a href="https://vita.had.co.nz/papers/tidy-data.html">tidy data paper</a>. Please refer to that for more details.)</p>
<p>Code also used from here <a href="https://github.com/hadley/tidy-data.git" class="uri">https://github.com/hadley/tidy-data.git</a>. Also see <a href="https://cran.r-project.org/web/packages/tidyr/vignettes/tidy-data.html">this</a></p>
<div id="importing-data" class="section level1">
<h1>Importing Data</h1>
<p>The first step is to ensure that the data has been imported correctly. This means checking the following:</p>
<ul>
<li>Read in the data</li>
<li>Check the packaging</li>
<li>Look at the top and bottom of your data</li>
<li>Check n</li>
<li>Validate with at least one external data source</li>
<li>Make a plot</li>
</ul>
<p>The attached dataset contains 5,960 records of bank customers who have received home equity loans, and whether they have defaulted on the loan.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1">hmeq &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;hmeq.csv&quot;</span>)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">head</span>(hmeq)</a>
<a class="sourceLine" id="cb1-3" title="3"><span class="co">#&gt;   Default Loan Mortgage  Value  Reason    Job  YOJ Derogatories Delinquencies</span></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="co">#&gt; 1       1 1100    25860  39025 HomeImp  Other 10.5            0             0</span></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="co">#&gt; 2       1 1300    70053  68400 HomeImp  Other  7.0            0             2</span></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="co">#&gt; 3       1 1500    13500  16700 HomeImp  Other  4.0            0             0</span></a>
<a class="sourceLine" id="cb1-7" title="7"><span class="co">#&gt; 4       1 1500       NA     NA                  NA           NA            NA</span></a>
<a class="sourceLine" id="cb1-8" title="8"><span class="co">#&gt; 5       0 1700    97800 112000 HomeImp Office  3.0            0             0</span></a>
<a class="sourceLine" id="cb1-9" title="9"><span class="co">#&gt; 6       1 1700    30548  40320 HomeImp  Other  9.0            0             0</span></a>
<a class="sourceLine" id="cb1-10" title="10"><span class="co">#&gt;       CLAGE Inquiries CLNO  DEBTINC</span></a>
<a class="sourceLine" id="cb1-11" title="11"><span class="co">#&gt; 1  94.36667         1    9       NA</span></a>
<a class="sourceLine" id="cb1-12" title="12"><span class="co">#&gt; 2 121.83333         0   14       NA</span></a>
<a class="sourceLine" id="cb1-13" title="13"><span class="co">#&gt; 3 149.46667         1   10       NA</span></a>
<a class="sourceLine" id="cb1-14" title="14"><span class="co">#&gt; 4        NA        NA   NA       NA</span></a>
<a class="sourceLine" id="cb1-15" title="15"><span class="co">#&gt; 5  93.33333         0   14       NA</span></a>
<a class="sourceLine" id="cb1-16" title="16"><span class="co">#&gt; 6 101.46600         1    8 37.11361</span></a>
<a class="sourceLine" id="cb1-17" title="17"><span class="kw">tail</span>(hmeq)</a>
<a class="sourceLine" id="cb1-18" title="18"><span class="co">#&gt;      Default  Loan Mortgage Value  Reason   Job YOJ Derogatories Delinquencies</span></a>
<a class="sourceLine" id="cb1-19" title="19"><span class="co">#&gt; 5955       0 88900    48919 93371 DebtCon Other  15            0             1</span></a>
<a class="sourceLine" id="cb1-20" title="20"><span class="co">#&gt; 5956       0 88900    57264 90185 DebtCon Other  16            0             0</span></a>
<a class="sourceLine" id="cb1-21" title="21"><span class="co">#&gt; 5957       0 89000    54576 92937 DebtCon Other  16            0             0</span></a>
<a class="sourceLine" id="cb1-22" title="22"><span class="co">#&gt; 5958       0 89200    54045 92924 DebtCon Other  15            0             0</span></a>
<a class="sourceLine" id="cb1-23" title="23"><span class="co">#&gt; 5959       0 89800    50370 91861 DebtCon Other  14            0             0</span></a>
<a class="sourceLine" id="cb1-24" title="24"><span class="co">#&gt; 5960       0 89900    48811 88934 DebtCon Other  15            0             0</span></a>
<a class="sourceLine" id="cb1-25" title="25"><span class="co">#&gt;         CLAGE Inquiries CLNO  DEBTINC</span></a>
<a class="sourceLine" id="cb1-26" title="26"><span class="co">#&gt; 5955 205.6502         0   15 34.81826</span></a>
<a class="sourceLine" id="cb1-27" title="27"><span class="co">#&gt; 5956 221.8087         0   16 36.11235</span></a>
<a class="sourceLine" id="cb1-28" title="28"><span class="co">#&gt; 5957 208.6921         0   15 35.85997</span></a>
<a class="sourceLine" id="cb1-29" title="29"><span class="co">#&gt; 5958 212.2797         0   15 35.55659</span></a>
<a class="sourceLine" id="cb1-30" title="30"><span class="co">#&gt; 5959 213.8927         0   16 34.34088</span></a>
<a class="sourceLine" id="cb1-31" title="31"><span class="co">#&gt; 5960 219.6010         0   16 34.57152</span></a>
<a class="sourceLine" id="cb1-32" title="32"><span class="kw">str</span>(hmeq)</a>
<a class="sourceLine" id="cb1-33" title="33"><span class="co">#&gt; &#39;data.frame&#39;:    5960 obs. of  13 variables:</span></a>
<a class="sourceLine" id="cb1-34" title="34"><span class="co">#&gt;  $ Default      : int  1 1 1 1 0 1 1 1 1 1 ...</span></a>
<a class="sourceLine" id="cb1-35" title="35"><span class="co">#&gt;  $ Loan         : int  1100 1300 1500 1500 1700 1700 1800 1800 2000 2000 ...</span></a>
<a class="sourceLine" id="cb1-36" title="36"><span class="co">#&gt;  $ Mortgage     : num  25860 70053 13500 NA 97800 ...</span></a>
<a class="sourceLine" id="cb1-37" title="37"><span class="co">#&gt;  $ Value        : num  39025 68400 16700 NA 112000 ...</span></a>
<a class="sourceLine" id="cb1-38" title="38"><span class="co">#&gt;  $ Reason       : chr  &quot;HomeImp&quot; &quot;HomeImp&quot; &quot;HomeImp&quot; &quot;&quot; ...</span></a>
<a class="sourceLine" id="cb1-39" title="39"><span class="co">#&gt;  $ Job          : chr  &quot;Other&quot; &quot;Other&quot; &quot;Other&quot; &quot;&quot; ...</span></a>
<a class="sourceLine" id="cb1-40" title="40"><span class="co">#&gt;  $ YOJ          : num  10.5 7 4 NA 3 9 5 11 3 16 ...</span></a>
<a class="sourceLine" id="cb1-41" title="41"><span class="co">#&gt;  $ Derogatories : int  0 0 0 NA 0 0 3 0 0 0 ...</span></a>
<a class="sourceLine" id="cb1-42" title="42"><span class="co">#&gt;  $ Delinquencies: int  0 2 0 NA 0 0 2 0 2 0 ...</span></a>
<a class="sourceLine" id="cb1-43" title="43"><span class="co">#&gt;  $ CLAGE        : num  94.4 121.8 149.5 NA 93.3 ...</span></a>
<a class="sourceLine" id="cb1-44" title="44"><span class="co">#&gt;  $ Inquiries    : int  1 0 1 NA 0 1 1 0 1 0 ...</span></a>
<a class="sourceLine" id="cb1-45" title="45"><span class="co">#&gt;  $ CLNO         : int  9 14 10 NA 14 8 17 8 12 13 ...</span></a>
<a class="sourceLine" id="cb1-46" title="46"><span class="co">#&gt;  $ DEBTINC      : num  NA NA NA NA NA ...</span></a></code></pre></div>
<p>Now, let us examine the data in slightly greater details</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">library</span>(<span class="st">&quot;esquisse&quot;</span>)</a>
<a class="sourceLine" id="cb2-2" title="2"><span class="co">#&gt; Warning: package &#39;esquisse&#39; was built under R version 4.0.3</span></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb2-4" title="4"><span class="co">#&gt; Warning: package &#39;dplyr&#39; was built under R version 4.0.2</span></a>
<a class="sourceLine" id="cb2-5" title="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb2-6" title="6"><span class="co">#&gt; Attaching package: &#39;dplyr&#39;</span></a>
<a class="sourceLine" id="cb2-7" title="7"><span class="co">#&gt; The following objects are masked from &#39;package:stats&#39;:</span></a>
<a class="sourceLine" id="cb2-8" title="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb2-9" title="9"><span class="co">#&gt;     filter, lag</span></a>
<a class="sourceLine" id="cb2-10" title="10"><span class="co">#&gt; The following objects are masked from &#39;package:base&#39;:</span></a>
<a class="sourceLine" id="cb2-11" title="11"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb2-12" title="12"><span class="co">#&gt;     intersect, setdiff, setequal, union</span></a>
<a class="sourceLine" id="cb2-13" title="13"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb2-14" title="14"><span class="co">#&gt; Warning: package &#39;ggplot2&#39; was built under R version 4.0.2</span></a>
<a class="sourceLine" id="cb2-15" title="15"></a>
<a class="sourceLine" id="cb2-16" title="16">facVariables &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Default&quot;</span>,<span class="st">&quot;Reason&quot;</span>,<span class="st">&quot;Job&quot;</span>)</a>
<a class="sourceLine" id="cb2-17" title="17">hmeq<span class="op">$</span>Default &lt;-<span class="st"> </span><span class="kw">as.factor</span>(hmeq<span class="op">$</span>Default)</a>
<a class="sourceLine" id="cb2-18" title="18">hmeq<span class="op">$</span>Reason &lt;-<span class="st"> </span><span class="kw">as.factor</span>(hmeq<span class="op">$</span>Reason)</a>
<a class="sourceLine" id="cb2-19" title="19">hmeq<span class="op">$</span>Job &lt;-<span class="st"> </span><span class="kw">as.factor</span>(hmeq<span class="op">$</span>Job)</a>
<a class="sourceLine" id="cb2-20" title="20"></a>
<a class="sourceLine" id="cb2-21" title="21"><span class="co"># Let us plot one of the categorical variables</span></a>
<a class="sourceLine" id="cb2-22" title="22"><span class="co"># You can use the esquisser package to plot, and learn ggplot</span></a>
<a class="sourceLine" id="cb2-23" title="23"></a>
<a class="sourceLine" id="cb2-24" title="24"><span class="co"># esquisser(hmeq)</span></a>
<a class="sourceLine" id="cb2-25" title="25"></a>
<a class="sourceLine" id="cb2-26" title="26">hmeq <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-27" title="27"><span class="st"> </span><span class="kw">filter</span>(<span class="op">!</span>(Reason <span class="op">%in%</span><span class="st"> &quot;&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-28" title="28"><span class="st"> </span><span class="kw">filter</span>(<span class="op">!</span>(Job <span class="op">%in%</span><span class="st"> &quot;&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-29" title="29"><span class="st"> </span><span class="kw">ggplot</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb2-30" title="30"><span class="st"> </span><span class="kw">aes</span>(<span class="dt">x =</span> Job) <span class="op">+</span></a>
<a class="sourceLine" id="cb2-31" title="31"><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">fill =</span> <span class="st">&quot;#0c4c8a&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2-32" title="32"><span class="st"> </span><span class="kw">theme_minimal</span>()</a></code></pre></div>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASAAAAEgCAMAAAAjXV6yAAAA7VBMVEUAAAAAADoAAGYAOpAAZrYMTIo6AAA6ADo6AGY6kNtNTU1NTW5NTY5Nbo5NbqtNjqtNjrVNjshmAABmADpmtv9uTU1uTW5uTY5ubo5ubqtujo5ujqtujshuq8huq+SDTU2OTU2OTW6OTY6Obk2Obm6Ojk2Ojm6Ojo6OjsiOyOSOyP+QOgCQkGaQ2/+rbk2rbm6rbo6rjqurq46ryKur5P+2ZgC2///Ijk3Ijm7IyI7I5KvI/8jI/+TI///bkDrb///kq27kq47k/8jk/+Tk///r6+v/tmb/yI7/25D/5Kv//7b//8j//9v//+T///8RTRWuAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAIJklEQVR4nO2djVvbVBjFuzGnKzAVB7ipHbLpNDg2XVmV2VGVUUJp/v8/x/uRNDdN0nOb3JSb9pznGYHm9H1vfrkfWb5uJ6IWqnPXBfBdBAREQEAEBERAQAQE5B7QJzceX8IQEAHV8xAQAdXzEBAB1fMQEAHV8xAQAdXzeAPoM6CKqQiomdKkIiACquchIAKq56kF6JNDIUAuc9nICaBiatU8a1mDlk9X7iEg4CEg4CEg4CEg4CEg4CEg4CEg4CEg4CEg4CEg4CEg4CEg4CEg4CEg4CEg4CEg4CEg4GkhoHC/2w2iaHLUfXw5v3BfpPYBmvzYj8KD/vQ0iEZfR9lFA0VqH6Cx5DAIJsfDKDwcZhcNFKl9gKRELQqfXuYXSWSHQoBc5rKRFaDpaS8aP1ZIsovK+6Pc08YaNDnqia56QQ1yWaQWAgr3xRgWsQ8qk+YTyWamhi9z0UCR2gdo1JUKeBzkWgRUJ125h4CAh4CAh4CAh4CAh4CAh4CAh4CAh4CAh4CAh4CAh4CAh4CAh4CAh4CAh4CAZy0BubzMggC5zGUjJ4CKqVXzrGUNWj5duYeAgIeAgIeAgIeAgIeAgIeAgIeAgIeAgIeAgIeAgIeAgIeAgIeAgIeAgIeAgIeAgIeAgKeVgNQd0fJu150h73It0FiCiQbx7dJ82mdeg+13ogZN36gHD3infZEkCtGm5O3kfNqnDFB40Je1iE/7FGnWmAYBn/YpkgGIfVCRJArZqKZvh3zap0jJcdB2n0/7uBMB1UlX7iEg4CEg4CEg4CEg4CEg4CEg4GkDoJu9J3Jxdf+9RVTXRSIg4PEf0MdOogcWQZ0XyX9AsxpUU2sMyI3WGdD1Q9XE2AcZMgHdntTrfSzSlXvaAIh9UIGyNYiAcsr0QTWPgCzSlXtsAFWA6LiJdZbrpF1eh0Ibb+txpSJAbrTGNciN1hjQ0k1s+XTlnjYA0rr55rVF0Irpyj3tARRdbV1YRK2WrtzTJkBsYoYKAJ2xBhkq6KTvsQ8yxGGegOqVOAtInXZ9ZBGzarpyTysAfZTj181ePUJrDMj7qxoE5DkgNrECsZPmMF+vxAS0DKDbk0f1r/2sM6AzycYgpG4D9uil/3cNaH6YV49D+TT5kWeA9ONQPk08cteAcsdB6mkfjyY/svG4UiGg6Cp7HJQ8q+HL5Ed3XoPmhWrQ8unKPa0FxD5ogSQKnyY/8hIQj4Nci4AqpLPYMgIioAXpCAikIyCQjoBAOgIC6QgIpCMgkI6AQDoCAukICKQjIJCOgEA6AgLpCAik21RALq/XOArT8GWfKkKltvQ4CpPbhzb7edFKAiIgKAICIiAgAgIiICACAiIgIAICIiAgAgIiICACAiIgIAICIiAgAgIiIKCagNDkRxsPCE1+tOmA4ORHmw4ITn6ESr3ul33g5Eeo1JYeR2HmtaJRbNHkRwQULZ78aNMBwcmPNh0QnPxo4wEhERAQAQEREBABAREQEAEBERAQAQEREBABAREQEAEBERAQAQEREBABARHQgsi87GMhVGpLj6MwuX1os58XrSQgAoIiICACAiKgCiUmINswBATCEBAIQ0AgDAGBMAQEwqwbIEdhCAh5CAh4CAh4CAh4CAh4CAh4KgPy/S5XR2EqA/L+aR9HYSoD8v5Oe0dhKgNqbm4f31QRUHNz+/gaplYNWj6dvceXMPX7oKXS2Xt8CbP0KNbU3D6+hql/HLRUOnuPL2G8mdvH1zAERED1PAREQPU87gGtmQgIiICACAiIgIAICIiAgAgIiICAXAEK9+VZosFO2bm0kXqPVTQ97f5w2n1WfMot9oSHw/w5uXBfrOz2zI9ErGfq023zDKd8Y1ZaigUn93JGEa+XtzkDdPDdZTR5WVaekTyXfdQr3ngbj552OnOyt9A3OQp0JONrhcobi73OAB3+3I/CV4fqfYK7L/vhty+M2iTP1ErPhyO1x99pm9jz4mdiMzw754c/qcqkV8tY57L009NAxVUfywDv4m0aqPOcE/XNGKSscoGeEF7nGJsVxiAe55B5twtOtrsD9FcQ/SMLLAo73u6H+4Gxdqz2lNw+taNUfQ7kp4P0DG7Gs99Tf+vVMpbanvBAxx2otcZOnxx/OFaZR1+d6kqhGGlDTE8YzJPF09iY5Gi+Bp1/P317rl/iNX3Tz2Yb65INUkB6vdqDx8Mij3ohmF6t/lK9TVwlxDfk+9QkSPmp2NKR6D5i93jWKemvxh/nr8VoY5qjaUB///7vLzLN08syQGYNkrb4HYTx5sx5FCC9Ov4rzqN/1ylmWeS7+tJg8q9oIJtUGkQizjUhYUxzNA1o+OcfvbCkBiX9yzCcq0HH+X5qaADSq+cBGTUoyTJ4pRtRjHkQyD5YG4wcY+N6w8w4y9E4oLHe13EflM02Um+D7aXbL/sgsdC9SZEnSmKpziYDKN8HhU//e9NXH+8+D6KYnuqyZkFkGhOQGsVk+8oFawxQnEPU2S/na5Bq8OkxTmiOYmm9HyfHSmosSk05QMnAE/dB3V91j6/cssnIkOKgavdFkAbRTc4oUWKc5WgWUEbg2mur5ByQOB4tPJ5oq/h/MSACAiIgIAICagGgq/vvk1+vP3+96uwEBERAQC0BdHvS6TyQgH7rdLYuVpm9HYBuTx5E8t/1w60LuVyh2gFItTLx4/rhk1W3s5YAks1KgLn+QoC62XuywuwEBOQ5oI+CjKBzde+1bmKydbGJGZJkznQHzU66UGd6WDeH+ZXy8R7QnYuAgAgIiICACAiIgIAICIiAgAgIiICA/gdlRB/YsiQs1wAAAABJRU5ErkJggg==" /><!-- --></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">summary</span>(hmeq<span class="op">$</span>Job)</a>
<a class="sourceLine" id="cb3-2" title="2"><span class="co">#&gt;             Mgr  Office   Other ProfExe   Sales    Self </span></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="co">#&gt;     279     767     948    2388    1276     109     193</span></a></code></pre></div>
<p>Other than missing values, Job looks fine. Let us now look at “Reason”</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">hmeq <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-2" title="2"><span class="st"> </span><span class="kw">filter</span>(<span class="op">!</span>(Reason <span class="op">%in%</span><span class="st"> &quot;&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="st"> </span><span class="kw">ggplot</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="st"> </span><span class="kw">aes</span>(<span class="dt">x =</span> Reason) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">fill =</span> <span class="st">&quot;#0c4c8a&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-6" title="6"><span class="st"> </span><span class="kw">theme_minimal</span>()</a></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">summary</span>(hmeq<span class="op">$</span>Reason)</a>
<a class="sourceLine" id="cb5-2" title="2"><span class="co">#&gt;         DebtCon HomeImp </span></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="co">#&gt;     252    3928    1780</span></a></code></pre></div>
<p>Let us now look at some quantitative variables</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"></a>
<a class="sourceLine" id="cb6-2" title="2">hmeq <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="st"> </span><span class="kw">ggplot</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb6-4" title="4"><span class="st"> </span><span class="kw">aes</span>(<span class="dt">x =</span> Value) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-5" title="5"><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> 30L, <span class="dt">fill =</span> <span class="st">&quot;#0c4c8a&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-6" title="6"><span class="st"> </span><span class="kw">theme_minimal</span>()</a>
<a class="sourceLine" id="cb6-7" title="7"><span class="co">#&gt; Warning: Removed 112 rows containing non-finite values (stat_bin).</span></a></code></pre></div>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASAAAAEgCAMAAAAjXV6yAAAArlBMVEUAAAAAADoAAGYAOpAAZrYMTIo6AAA6ADo6AGY6Ojo6kNtNTU1NTW5NTY5NbqtNjshmAABmADpmtrZmtv9uTU1uTW5uTY5ubqtuq+SOTU2OTW6OTY6OyP+QOgCQtpCQ27aQ2/+rbk2rbm6rbo6ryKur5P+2ZgC2///Ijk3I///bkDrb/9vb///kq27k///r6+v/tmb/yI7/25D/29v/5Kv//7b//8j//9v//+T///+8IQqOAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAG4UlEQVR4nO3d/VvaVhjGcXyp68B1ONvNbrjadiiy2qIDJf//P7acJCAHT859EmLIlXzvH0R5mifpx5OXC+GkFxFvevvegKYHIBGARAASAUgEIJHqgH6ULda/YJGuAIkaQKIGkKgBJGoAiRpAorYT0I8WpxIgW6tsscUjKHilAImVAuRa6Zs0RbcovAjQay0IUIVdARI1gEQNIFEDSNQAEjWARA0gUQNI1AASNYBEDSBRA0jUABI1gEQNIFEDSNQAEjWARA0gUQNI1AASNS/Q/PfbKLobDAa/3EaPHwfvvkerB2/jN1aKblF4ce9A9wYmmozM98vPo+ju19WDv3FXgCan/8QjaPllbH54/OvWDKjswd+4K0DpLhbvU4PBKJr/8T16/HOcPax6uWMD1fqmleoSDDT/MDaj6P5dIpM9+OW7NYKSTEbOEZTTuJNAHINcMRRmp1p+vV1+vkjPYhecxZ6zug46HUdcB+0cgEQAEgFIBCARgEQAEgFIBCARgEQAEgFIBCARgEQAEgFIBCARgEQAEgFIBCARgEQAEgFIBCARgBy93LGBan3TSnWpBMjWWn/HCBKNARKNARKNARKNARKNARKNARKNARKNARKNARKNARKNARKNARKNARKNARKNARKNARKNARKNARKNARKNARKNARKNARKNARKNARKNARKNuwOUfOrZ/rgzn3reSDL7iz3tC7O/bCSd/cWecqHbMy8shufmYXZ4kz2RTG5iTdpRYvaXNLW+daWKBAPZ076UmP1lYxwF/crCizWPoGlvlePVU2oE5TRuKdB6BD1nXsUxqEVAL2Io7GlfSsz+0iagh5NkF7OOQTtfB7UI6OnyOCqfDgC9OAYVSgeAni4B8h+Dnq+ASqQDQIthzz5IF0oHgHYLQCIdAGIXc9RejqDF2ZWvd0DjlgNFs6Nvvua6ceuB2MU24gC6ZgRtxHGQPuAYtBFO86IGkKjZQMnLrn1f65DG7QWamvPXYlhOqANAL/6qUSgAiXQAiF3MUeMgLWqc5kUNIFGzgJ4u++X/9tMFoGtjU1aoA0Cc5h21nYBy3lrjAqr1vT1VxAXEdZCjZp/FZlwHcZov2BUgUQNI1AASNYBEDSBRA0jUABI1gEQNIFEDSNQAEjWARA0gUQNI1AASNYBEDSBRA0jUABI1gEQNIFEDSNQAEjWARE0D3Q0GZhYYPhael8nIfC0/PU7bgZZfkpk6mJoiL/E+NRiMIqbHycv8w9iMIqbH8WYyYnocbyYjjkF5MTvV8ust0+PkJr4OOh0zPc7uAUgEIBGARPxAHieAAFo39tAABJAIQCIAiQAkApAIQCIAiQQBuZwAAmjdGCDRGCDRGCDRGCDRGCDRGCDRGCDRGCDRGCDRGKCtXtsJBdrD21mKphIgWytiBHkDkAhAIgCJACQCkEgRIIsJIIDWjQESjQESjQESjQESjQESjQESjQESjQESjQESjQESjQESjQESjQESjYsBZQEoDMgaVWX+KxUVASrWtQFAVnb4r1RUBKhYV4BErSiQ/1PPAOXN/rK7TEuA8mZeqBHo+d81ESho9pdWpCRQ0OwvBYutupIOmv1lty2qYcE9HIMq3KIaFnzVs1jA7C+7bVENC+7vOqiKLaphwf1dSZcqAiSKAIkiQKIIkCh2BailAUgEIBGARAASAUgEIBGARAASqQgo/1UQO/P3Znpz940EvNPpBiyRv6BZZ/FVpqkGyHMvACvm1VozxbnrRgL+2wroJTzbYF5JL77KNNUAeV6JtbfUbMZk5LyRgHdK74Al8rfB/FqKrzJLNUCe1/Jdm+u8kYB3UviAJfK3wYyO4qvMUg2Q569B2zGvajtvJOC9rUDAErnbkDxZfJVZ6h5Bjx8vsu+2bySgf53+JXIXvF8fgIuvsu5jUHwWG62+3b6RgD4g+JfIXXByEdbAvcVVncVy/xpkJfNx3kjAe1uBgCXytiE9PBdfZZZ6r4M2Lkpe3khAXc6oJXK2Idt5iq8yDVfSIgCJACQCkAhAIgCJNBXo6fI4eZwer555+OlqHxvSVKBoengTGafz1RMA2Uk9Ht7e2E/UnsYCRdf9KN3DHk56vV7fACVG5svTZa93eCNbVJHmAs2OviV72GJ4nuxwG0DJAWoa12tIc4EWZ1fJHvafcUh1VkAzM3oSuNdPc4HMPpaew2bxLnawCTTtJenXsRUNBpod/WvOYYvhwdXWCKpp70rSYKDF2d/mHGaORdHMGkHxT7VtRYOBouufzR5mNB5OEqDFsB8ftw/ig3SMVpNSk4FmveQwfB0fgT4Nz83wMWf8387S03xNo6jJQI0IQCIAiQAkApAIQCIAiQAkApAIQCL/A7SSH2HbtrJbAAAAAElFTkSuQmCC" /><!-- --></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="kw">summary</span>(hmeq<span class="op">$</span>Value)</a>
<a class="sourceLine" id="cb7-2" title="2"><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA&#39;s </span></a>
<a class="sourceLine" id="cb7-3" title="3"><span class="co">#&gt;    8000   66076   89236  101776  119824  855909     112</span></a>
<a class="sourceLine" id="cb7-4" title="4"><span class="kw">boxplot</span>(hmeq<span class="op">$</span>Value, <span class="dt">coef =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASAAAAEgCAMAAAAjXV6yAAAAQlBMVEUAAAAAADoAAGYAOpAAZrY6AAA6ADo6kNtmAABmtv+QOgCQ2/+2ZgC2///T09PbkDrb////tmb/25D//7b//9v///+/WGZFAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAEe0lEQVR4nO3c3XLaOhRAYeevTQKpQxK//6sWm0A7SczCoC1FyloXnV4wm57vCNvYjLrBjtaV/gd89wSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCEgN11VQKKO243czT/2sWDE3+wiLjppFL/n+fPjX5C4uMGyd2+z/Sjk3+wiLjDhMFgokCzU/0I0YjPUjTTE/zBRIIygy0/Aq+dK4gSCAoBOj1/vf2z832g3T9lGBc0eKA+pvn8W8Pl48rWhjQO83EdOG4ooUBvdxNQJuZD5lArqAjvd6PVzq3w/5wfeG4okWd5rdGV6vtiWzGR6DM4+ISCAoCenvcfePyQvHr+v2xZ/Yg9LOB3h4PLJ7mv+q/LxheKH6VK4jqu/cl5DFopt21dNfNrB+Bco+LSyAoEGjuBHbmuEIJBAkERQH1u7PY1erDFJ+L/csVBAkECZTlfUsnEBQHtP06dvO89qb9XJurVX/z7GOfucZbQuO9oD7jDbOqfoI33lQcgTLeUazrR5z7FbTOdkextp8B745Bh1uLl47jupi5oWexz9/Fzh+HVQeUddxw+B6cfGzyFxYZN42s6SC93p68Xu7yfsRqWkGTz69V1t8o1nQMmq6f1+MPqDI+OKwL6GH/dDXfhWJV10Hj6ukzr6CqDtKv99dP0xLazB2lf/x3sc3unHKbaNwpdSFj27kOqukgnX/cINCJE2sHinxw6DEIZ9Z0Fss8bj/SFUQTaz8GRY0bBDpxokBHRlb0XSz7uGmkQMcn1nRHMfu4QSCeKBBMFAgmCgQTBYKJAsFEgWCiQDBRIJgoEEwUCCYKBBMFgokCwcQmgNI+F+ugJO+R/IVFxg2trKCocdPImm65Ftk/KMInCKjQ/kEh6hFv7u4vkPsHQa4gqtD+QdUcg0rtH1QRUMw4unKOuLKuC+jPRX0noJgLxXaAgi4Um/mIRZ3mmwGKulBsBsgVRLnRJOVGk9net/RQgVLNXP7m+bfoEggS6OOQgNP6p/dI/sJdbjTJuU0gJBAk0EXvW02FgNprMdDxjSbbaykQbDTZXguBaKPJ9loIRBtNtteZK2huo8n2Ou8YNLvRZHudcxY7sgtee3kdBAkEJX703F6JHz23V+IHh+2V+NFze7mCoMSPntsr8aPn9vI6CBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBII+gvtmxTomo6B1wAAAABJRU5ErkJggg==" /><!-- --></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1"><span class="co"># Look for obvious inconsistencies</span></a>
<a class="sourceLine" id="cb8-2" title="2"></a>
<a class="sourceLine" id="cb8-3" title="3">mortgage_negative &lt;-<span class="st"> </span>hmeq<span class="op">$</span>Mortgage <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb8-4" title="4"><span class="kw">summary</span>(mortgage_negative)</a>
<a class="sourceLine" id="cb8-5" title="5"><span class="co">#&gt;    Mode   FALSE    NA&#39;s </span></a>
<a class="sourceLine" id="cb8-6" title="6"><span class="co">#&gt; logical    5442     518</span></a></code></pre></div>
<div id="missing-values" class="section level2">
<h2>missing values</h2>
<p>There are multiple approaches to filling in missing values, including omitting records with missing values</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="co"># Remove all records with NA values</span></a>
<a class="sourceLine" id="cb9-2" title="2">hmeq_removedNA &lt;-<span class="st"> </span><span class="kw">na.omit</span>(hmeq)</a>
<a class="sourceLine" id="cb9-3" title="3"><span class="kw">str</span>(hmeq_removedNA)</a>
<a class="sourceLine" id="cb9-4" title="4"><span class="co">#&gt; &#39;data.frame&#39;:    3515 obs. of  13 variables:</span></a>
<a class="sourceLine" id="cb9-5" title="5"><span class="co">#&gt;  $ Default      : Factor w/ 2 levels &quot;0&quot;,&quot;1&quot;: 2 2 1 2 1 1 1 2 2 1 ...</span></a>
<a class="sourceLine" id="cb9-6" title="6"><span class="co">#&gt;  $ Loan         : int  1700 1800 2300 2400 2400 2900 2900 2900 2900 3000 ...</span></a>
<a class="sourceLine" id="cb9-7" title="7"><span class="co">#&gt;  $ Mortgage     : num  30548 28502 102370 34863 98449 ...</span></a>
<a class="sourceLine" id="cb9-8" title="8"><span class="co">#&gt;  $ Value        : num  40320 43034 120953 47471 117195 ...</span></a>
<a class="sourceLine" id="cb9-9" title="9"><span class="co">#&gt;  $ Reason       : Factor w/ 3 levels &quot;&quot;,&quot;DebtCon&quot;,&quot;HomeImp&quot;: 3 3 3 3 3 3 3 3 2 3 ...</span></a>
<a class="sourceLine" id="cb9-10" title="10"><span class="co">#&gt;  $ Job          : Factor w/ 7 levels &quot;&quot;,&quot;Mgr&quot;,&quot;Office&quot;,..: 4 4 3 2 3 3 3 4 2 3 ...</span></a>
<a class="sourceLine" id="cb9-11" title="11"><span class="co">#&gt;  $ YOJ          : num  9 11 2 12 4 1 2 16 2 2 ...</span></a>
<a class="sourceLine" id="cb9-12" title="12"><span class="co">#&gt;  $ Derogatories : int  0 0 0 0 0 0 0 3 0 0 ...</span></a>
<a class="sourceLine" id="cb9-13" title="13"><span class="co">#&gt;  $ Delinquencies: int  0 0 0 0 0 0 0 0 0 0 ...</span></a>
<a class="sourceLine" id="cb9-14" title="14"><span class="co">#&gt;  $ CLAGE        : num  101.5 88.8 91 70.5 93.8 ...</span></a>
<a class="sourceLine" id="cb9-15" title="15"><span class="co">#&gt;  $ Inquiries    : int  1 0 0 1 0 0 0 2 3 0 ...</span></a>
<a class="sourceLine" id="cb9-16" title="16"><span class="co">#&gt;  $ CLNO         : int  8 8 13 21 13 13 13 8 37 14 ...</span></a>
<a class="sourceLine" id="cb9-17" title="17"><span class="co">#&gt;  $ DEBTINC      : num  37.1 36.9 31.6 38.3 29.7 ...</span></a>
<a class="sourceLine" id="cb9-18" title="18"><span class="co">#&gt;  - attr(*, &quot;na.action&quot;)= &#39;omit&#39; Named int [1:2445] 1 2 3 4 5 7 9 10 11 12 ...</span></a>
<a class="sourceLine" id="cb9-19" title="19"><span class="co">#&gt;   ..- attr(*, &quot;names&quot;)= chr [1:2445] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...</span></a>
<a class="sourceLine" id="cb9-20" title="20"></a>
<a class="sourceLine" id="cb9-21" title="21"><span class="co"># Replace values by the mean</span></a>
<a class="sourceLine" id="cb9-22" title="22">x &lt;-<span class="st"> </span>hmeq<span class="op">$</span>Mortgage</a>
<a class="sourceLine" id="cb9-23" title="23"><span class="kw">summary</span>(x)</a>
<a class="sourceLine" id="cb9-24" title="24"><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA&#39;s </span></a>
<a class="sourceLine" id="cb9-25" title="25"><span class="co">#&gt;    2063   46276   65019   73761   91488  399550     518</span></a>
<a class="sourceLine" id="cb9-26" title="26">x[<span class="kw">is.na</span>(x)] &lt;-<span class="st"> </span><span class="kw">mean</span>(x,<span class="dt">na.rm=</span>T)</a>
<a class="sourceLine" id="cb9-27" title="27"><span class="kw">summary</span>(x)</a>
<a class="sourceLine" id="cb9-28" title="28"><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></a>
<a class="sourceLine" id="cb9-29" title="29"><span class="co">#&gt;    2063   48139   69529   73761   88200  399550</span></a>
<a class="sourceLine" id="cb9-30" title="30"></a>
<a class="sourceLine" id="cb9-31" title="31"><span class="co"># We can use the Hmisc package to do imputation with other summary measures</span></a>
<a class="sourceLine" id="cb9-32" title="32"><span class="kw">require</span>(Hmisc)</a>
<a class="sourceLine" id="cb9-33" title="33"><span class="co">#&gt; Loading required package: Hmisc</span></a>
<a class="sourceLine" id="cb9-34" title="34"><span class="co">#&gt; Warning: package &#39;Hmisc&#39; was built under R version 4.0.3</span></a>
<a class="sourceLine" id="cb9-35" title="35"><span class="co">#&gt; Loading required package: lattice</span></a>
<a class="sourceLine" id="cb9-36" title="36"><span class="co">#&gt; Loading required package: survival</span></a>
<a class="sourceLine" id="cb9-37" title="37"><span class="co">#&gt; Loading required package: Formula</span></a>
<a class="sourceLine" id="cb9-38" title="38"><span class="co">#&gt; Warning: package &#39;Formula&#39; was built under R version 4.0.3</span></a>
<a class="sourceLine" id="cb9-39" title="39"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb9-40" title="40"><span class="co">#&gt; Attaching package: &#39;Hmisc&#39;</span></a>
<a class="sourceLine" id="cb9-41" title="41"><span class="co">#&gt; The following objects are masked from &#39;package:dplyr&#39;:</span></a>
<a class="sourceLine" id="cb9-42" title="42"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb9-43" title="43"><span class="co">#&gt;     src, summarize</span></a>
<a class="sourceLine" id="cb9-44" title="44"><span class="co">#&gt; The following objects are masked from &#39;package:base&#39;:</span></a>
<a class="sourceLine" id="cb9-45" title="45"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb9-46" title="46"><span class="co">#&gt;     format.pval, units</span></a>
<a class="sourceLine" id="cb9-47" title="47">xmed &lt;-<span class="st"> </span>hmeq<span class="op">$</span>Mortgage</a>
<a class="sourceLine" id="cb9-48" title="48"><span class="kw">summary</span>(xmed)</a>
<a class="sourceLine" id="cb9-49" title="49"><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA&#39;s </span></a>
<a class="sourceLine" id="cb9-50" title="50"><span class="co">#&gt;    2063   46276   65019   73761   91488  399550     518</span></a>
<a class="sourceLine" id="cb9-51" title="51">xmed &lt;-<span class="st"> </span><span class="kw">impute</span>(xmed, <span class="dt">fun =</span> median)</a>
<a class="sourceLine" id="cb9-52" title="52"><span class="kw">summary</span>(xmed)</a>
<a class="sourceLine" id="cb9-53" title="53"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb9-54" title="54"><span class="co">#&gt;  518 values imputed to 65019</span></a>
<a class="sourceLine" id="cb9-55" title="55"><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></a>
<a class="sourceLine" id="cb9-56" title="56"><span class="co">#&gt;    2063   48139   65019   73001   88200  399550</span></a></code></pre></div>
<p>There are other missing value imputation methods, including multivariate imputation. Checkout the <a href="https://cran.r-project.org/web/packages/mice/mice.pdf">mice</a> package.</p>
</div>
</div>
<div id="data-tidying" class="section level1">
<h1>Data tidying</h1>
<p>It is often said that 80% of data analysis is spent on the cleaning and preparing data. And it’s not just a first step, but it must be repeated many times over the course of analysis as new problems come to light or new data is collected. To get a handle on the problem, this paper focuses on a small, but important, aspect of data cleaning that I call data <strong>tidying</strong>: structuring datasets to facilitate analysis.</p>
<p>The principles of tidy data provide a standard way to organise data values within a dataset. A standard makes initial data cleaning easier because you don’t need to start from scratch and reinvent the wheel every time. The tidy data standard has been designed to facilitate initial exploration and analysis of the data, and to simplify the development of data analysis tools that work well together. Current tools often require translation. You have to spend time munging the output from one tool so you can input it into another. Tidy datasets and tidy tools work hand in hand to make data analysis easier, allowing you to focus on the interesting domain problem, not on the uninteresting logistics of data.</p>
</div>
<div id="sec:defining" class="section level1">
<h1>Defining tidy data</h1>
<blockquote>
<p>Happy families are all alike; every unhappy family is unhappy in its own way — Leo Tolstoy</p>
</blockquote>
<p>Like families, tidy datasets are all alike but every messy dataset is messy in its own way. Tidy datasets provide a standardized way to link the structure of a dataset (its physical layout) with its semantics (its meaning). In this section, I’ll provide some standard vocabulary for describing the structure and semantics of a dataset, and then use those definitions to define tidy data.</p>
<div id="data-structure" class="section level2">
<h2>Data structure</h2>
<p>Most statistical datasets are data frames made up of <strong>rows</strong> and <strong>columns</strong>. The columns are almost always labeled and the rows are sometimes labeled. The following code provides some data about an imaginary experiment in a format commonly seen in the wild. The table has two columns and three rows, and both rows and columns are labeled.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1">preg &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;preg.csv&quot;</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb10-2" title="2">preg</a>
<a class="sourceLine" id="cb10-3" title="3"><span class="co">#&gt;           name treatmenta treatmentb</span></a>
<a class="sourceLine" id="cb10-4" title="4"><span class="co">#&gt; 1   John Smith         NA         18</span></a>
<a class="sourceLine" id="cb10-5" title="5"><span class="co">#&gt; 2     Jane Doe          4          1</span></a>
<a class="sourceLine" id="cb10-6" title="6"><span class="co">#&gt; 3 Mary Johnson          6          7</span></a></code></pre></div>
<p>There are many ways to structure the same underlying data. The following table shows the same data as above, but the rows and columns have been transposed.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="kw">t</span>(preg)</a>
<a class="sourceLine" id="cb11-2" title="2"><span class="co">#&gt;            [,1]         [,2]       [,3]          </span></a>
<a class="sourceLine" id="cb11-3" title="3"><span class="co">#&gt; name       &quot;John Smith&quot; &quot;Jane Doe&quot; &quot;Mary Johnson&quot;</span></a>
<a class="sourceLine" id="cb11-4" title="4"><span class="co">#&gt; treatmenta NA           &quot; 4&quot;       &quot; 6&quot;          </span></a>
<a class="sourceLine" id="cb11-5" title="5"><span class="co">#&gt; treatmentb &quot;18&quot;         &quot; 1&quot;       &quot; 7&quot;</span></a></code></pre></div>
<p>The data is the same, but the layout is different. Our vocabulary of rows and columns is simply not rich enough to describe why the two tables represent the same data. In addition to appearance, we need a way to describe the underlying semantics, or meaning, of the values displayed in the table.</p>
</div>
<div id="data-semantics" class="section level2">
<h2>Data semantics</h2>
<p>A dataset is a collection of <strong>values</strong>, usually either numbers (if quantitative) or strings (if qualitative). Values are organised in two ways. Every value belongs to a <strong>variable</strong> and an <strong>observation</strong>. A variable contains all values that measure the same underlying attribute (like height, temperature, duration) across units. An observation contains all values measured on the same unit (like a person, or a day, or a race) across attributes.</p>
<p>A tidy version of the pregnancy data looks like this:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1"><span class="kw">library</span>(tidyr)</a>
<a class="sourceLine" id="cb12-2" title="2"><span class="co">#&gt; Warning: package &#39;tidyr&#39; was built under R version 4.0.2</span></a>
<a class="sourceLine" id="cb12-3" title="3"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb12-4" title="4"><span class="co"># Make tidy version</span></a>
<a class="sourceLine" id="cb12-5" title="5"></a>
<a class="sourceLine" id="cb12-6" title="6">preg2 &lt;-<span class="st"> </span>preg <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-7" title="7"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="dt">cols=</span><span class="kw">c</span>(<span class="st">&quot;treatmenta&quot;</span>,<span class="st">&quot;treatmentb&quot;</span>),<span class="dt">names_to =</span> <span class="st">&quot;treatment&quot;</span>,<span class="dt">values_to =</span> <span class="st">&quot;result&quot;</span>)</a>
<a class="sourceLine" id="cb12-8" title="8">preg2</a>
<a class="sourceLine" id="cb12-9" title="9"><span class="co">#&gt; # A tibble: 6 x 3</span></a>
<a class="sourceLine" id="cb12-10" title="10"><span class="co">#&gt;   name         treatment  result</span></a>
<a class="sourceLine" id="cb12-11" title="11"><span class="co">#&gt;   &lt;chr&gt;        &lt;chr&gt;       &lt;int&gt;</span></a>
<a class="sourceLine" id="cb12-12" title="12"><span class="co">#&gt; 1 John Smith   treatmenta     NA</span></a>
<a class="sourceLine" id="cb12-13" title="13"><span class="co">#&gt; 2 John Smith   treatmentb     18</span></a>
<a class="sourceLine" id="cb12-14" title="14"><span class="co">#&gt; 3 Jane Doe     treatmenta      4</span></a>
<a class="sourceLine" id="cb12-15" title="15"><span class="co">#&gt; 4 Jane Doe     treatmentb      1</span></a>
<a class="sourceLine" id="cb12-16" title="16"><span class="co">#&gt; 5 Mary Johnson treatmenta      6</span></a>
<a class="sourceLine" id="cb12-17" title="17"><span class="co">#&gt; 6 Mary Johnson treatmentb      7</span></a></code></pre></div>
<p>This makes the values, variables and observations more clear. The dataset contains 18 values representing three variables and six observations. The variables are:</p>
<ol style="list-style-type: decimal">
<li><p><code>name</code>, with three possible values (John, Mary, and Jane).</p></li>
<li><p><code>treatment</code>, with two possible values (a and b).</p></li>
<li><p><code>n</code>, with five or six values depending on how you think of the missing value ()</p></li>
</ol>
<p>The experimental design tells us more about the structure of the observations. In this experiment, every combination of of <code>name</code> and <code>treatment</code> was measured, a completely crossed design. The experimental design also determines whether or not missing values can be safely dropped. In this experiment, the missing value represents an observation that should have been made, but wasn’t, so it’s important to keep it. Structural missing values, which represent measurements that can’t be made (e.g., the count of pregnant males) can be safely removed.</p>
<p>For a given dataset, it’s usually easy to figure out what are observations and what are variables, but it is surprisingly difficult to precisely define variables and observations in general. For example, if the columns in the pregnancy data were <code>height</code> and <code>weight</code> we would have been happy to call them variables. If the columns were <code>height</code> and <code>width</code>, it would be less clear cut, as we might think of height and width as values of a <code>dimension</code> variable. If the columns were <code>home phone</code> and <code>work phone</code>, we could treat these as two variables, but in a fraud detection environment we might want variables <code>phone number</code> and <code>number type</code> because the use of one phone number for multiple people might suggest fraud. A general rule of thumb is that it is easier to describe functional relationships between variables (e.g., <code>z</code> is a linear combination of <code>x</code> and <code>y</code>, <code>density</code> is the ratio of <code>weight</code> to <code>volume</code>) than between rows, and it is easier to make comparisons between groups of observations (e.g., average of group a vs. average of group b) than between groups of columns.</p>
<p>In a given analysis, there may be multiple levels of observation. For example, in a trial of new allergy medication we might have three observational types: demographic data collected from each person (<code>age</code>, <code>sex</code>, <code>race</code>), medical data collected from each person on each day (<code>number of sneezes</code>, <code>redness of eyes</code>), and meteorological data collected on each day (<code>temperature</code>, <code>pollen count</code>).</p>
<p>Variables may change over the course of analysis. Often the variables in the raw data are very fine grained, and may add extra modelling complexity for little explanatory gain. For example, many surveys ask variations on the same question to better get at an underlying trait. In early stages of analysis, variables correspond to questions. In later stages, you change focus to traits, computed by averaging together multiple questions. This considerably simplifies analysis because you don’t need a hierarchical model, and you can often pretend that the data is continuous, not discrete.</p>
</div>
<div id="tidy-data" class="section level2">
<h2>Tidy data</h2>
<p>Tidy data is a standard way of mapping the meaning of a dataset to its structure. A dataset is messy or tidy depending on how rows, columns and tables are matched up with observations, variables and types. In <strong>tidy data</strong>:</p>
<ol style="list-style-type: decimal">
<li><p>Each variable forms a column.</p></li>
<li><p>Each observation forms a row.</p></li>
<li><p>Each type of observational unit forms a table.</p></li>
</ol>
<p>This is Codd’s 3rd normal form, but with the constraints framed in statistical language, and the focus put on a single dataset rather than the many connected datasets common in relational databases. <strong>Messy data</strong> is any other arrangement of the data.</p>
<p>Tidy data makes it easy for an analyst or a computer to extract needed variables because it provides a standard way of structuring a dataset. Compare the different versions of the pregnancy data: in the messy version you need to use different strategies to extract different variables. This slows analysis and invites errors. If you consider how many data analysis operations involve all of the values in a variable (every aggregation function), you can see how important it is to extract these values in a simple, standard way. Tidy data is particularly well suited for vectorised programming languages like R, because the layout ensures that values of different variables from the same observation are always paired.</p>
<p>While the order of variables and observations does not affect analysis, a good ordering makes it easier to scan the raw values. One way of organising variables is by their role in the analysis: are values fixed by the design of the data collection, or are they measured during the course of the experiment? Fixed variables describe the experimental design and are known in advance. Computer scientists often call fixed variables dimensions, and statisticians usually denote them with subscripts on random variables. Measured variables are what we actually measure in the study. Fixed variables should come first, followed by measured variables, each ordered so that related variables are contiguous. Rows can then be ordered by the first variable, breaking ties with the second and subsequent (fixed) variables. This is the convention adopted by all tabular displays in this paper.</p>
</div>
</div>
<div id="sec:tidying" class="section level1">
<h1>Tidying messy datasets</h1>
<p>Real datasets can, and often do, violate the three precepts of tidy data in almost every way imaginable. While occasionally you do get a dataset that you can start analysing immediately, this is the exception, not the rule. This section describes the five most common problems with messy datasets, along with their remedies:</p>
<ul>
<li><p>Column headers are values, not variable names.</p></li>
<li><p>Multiple variables are stored in one column.</p></li>
<li><p>Variables are stored in both rows and columns.</p></li>
<li><p>Multiple types of observational units are stored in the same table.</p></li>
<li><p>A single observational unit is stored in multiple tables.</p></li>
</ul>
<p>Surprisingly, most messy datasets, including types of messiness not explicitly described above, can be tidied with a small set of tools: gathering, separating and spreading. The following sections illustrate each problem with a real dataset that I have encountered, and show how to tidy them.</p>
<div id="column-headers-are-values-not-variable-names" class="section level2">
<h2>Column headers are values, not variable names</h2>
<p>A common type of messy dataset is tabular data designed for presentation, where variables form both the rows and columns, and column headers are values, not variable names. While I would call this arrangement messy, in some cases it can be extremely useful. It provides efficient storage for completely crossed designs, and it can lead to extremely efficient computation if desired operations can be expressed as matrix operations.</p>
<p>The following code shows a subset of a typical dataset of this form. This dataset explores the relationship between income and religion in the US. It comes from a report produced by the Pew Research Center, an American think-tank that collects data on attitudes to topics ranging from religion to the internet, and produces many reports that contain datasets in this format.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1">relig_income</a>
<a class="sourceLine" id="cb13-2" title="2"><span class="co">#&gt; # A tibble: 18 x 11</span></a>
<a class="sourceLine" id="cb13-3" title="3"><span class="co">#&gt;    religion `&lt;$10k` `$10-20k` `$20-30k` `$30-40k` `$40-50k` `$50-75k` `$75-100k`</span></a>
<a class="sourceLine" id="cb13-4" title="4"><span class="co">#&gt;    &lt;chr&gt;      &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb13-5" title="5"><span class="co">#&gt;  1 Agnostic      27        34        60        81        76       137        122</span></a>
<a class="sourceLine" id="cb13-6" title="6"><span class="co">#&gt;  2 Atheist       12        27        37        52        35        70         73</span></a>
<a class="sourceLine" id="cb13-7" title="7"><span class="co">#&gt;  3 Buddhist      27        21        30        34        33        58         62</span></a>
<a class="sourceLine" id="cb13-8" title="8"><span class="co">#&gt;  4 Catholic     418       617       732       670       638      1116        949</span></a>
<a class="sourceLine" id="cb13-9" title="9"><span class="co">#&gt;  5 Don’t k~      15        14        15        11        10        35         21</span></a>
<a class="sourceLine" id="cb13-10" title="10"><span class="co">#&gt;  6 Evangel~     575       869      1064       982       881      1486        949</span></a>
<a class="sourceLine" id="cb13-11" title="11"><span class="co">#&gt;  7 Hindu          1         9         7         9        11        34         47</span></a>
<a class="sourceLine" id="cb13-12" title="12"><span class="co">#&gt;  8 Histori~     228       244       236       238       197       223        131</span></a>
<a class="sourceLine" id="cb13-13" title="13"><span class="co">#&gt;  9 Jehovah~      20        27        24        24        21        30         15</span></a>
<a class="sourceLine" id="cb13-14" title="14"><span class="co">#&gt; 10 Jewish        19        19        25        25        30        95         69</span></a>
<a class="sourceLine" id="cb13-15" title="15"><span class="co">#&gt; # ... with 8 more rows, and 3 more variables: `$100-150k` &lt;dbl&gt;, `&gt;150k` &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb13-16" title="16"><span class="co">#&gt; #   `Don&#39;t know/refused` &lt;dbl&gt;</span></a></code></pre></div>
<p>This dataset has three variables, <code>religion</code>, <code>income</code> and <code>frequency</code>. To tidy it, we need to <strong>gather</strong> the non-variable columns into a two-column key-value pair. This action is often described as making a wide dataset long (or tall), but I’ll avoid those terms because they’re imprecise.</p>
<p>When gathering variables, we need to provide the name of the new key-value columns to create. The first argument, is the name of the key column, which is the name of the variable defined by the values of the column headings. In this case, it’s <code>income</code>. The second argument is the name of the value column, <code>frequency</code>. The third argument defines the columns to gather, here, every column except religion.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1">relig_income <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb14-2" title="2"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="op">-</span>religion, <span class="dt">names_to =</span> <span class="st">&quot;income&quot;</span>, <span class="dt">values_to =</span> <span class="st">&quot;frequency&quot;</span>)</a>
<a class="sourceLine" id="cb14-3" title="3"><span class="co">#&gt; # A tibble: 180 x 3</span></a>
<a class="sourceLine" id="cb14-4" title="4"><span class="co">#&gt;    religion income             frequency</span></a>
<a class="sourceLine" id="cb14-5" title="5"><span class="co">#&gt;    &lt;chr&gt;    &lt;chr&gt;                  &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb14-6" title="6"><span class="co">#&gt;  1 Agnostic &lt;$10k                     27</span></a>
<a class="sourceLine" id="cb14-7" title="7"><span class="co">#&gt;  2 Agnostic $10-20k                   34</span></a>
<a class="sourceLine" id="cb14-8" title="8"><span class="co">#&gt;  3 Agnostic $20-30k                   60</span></a>
<a class="sourceLine" id="cb14-9" title="9"><span class="co">#&gt;  4 Agnostic $30-40k                   81</span></a>
<a class="sourceLine" id="cb14-10" title="10"><span class="co">#&gt;  5 Agnostic $40-50k                   76</span></a>
<a class="sourceLine" id="cb14-11" title="11"><span class="co">#&gt;  6 Agnostic $50-75k                  137</span></a>
<a class="sourceLine" id="cb14-12" title="12"><span class="co">#&gt;  7 Agnostic $75-100k                 122</span></a>
<a class="sourceLine" id="cb14-13" title="13"><span class="co">#&gt;  8 Agnostic $100-150k                109</span></a>
<a class="sourceLine" id="cb14-14" title="14"><span class="co">#&gt;  9 Agnostic &gt;150k                     84</span></a>
<a class="sourceLine" id="cb14-15" title="15"><span class="co">#&gt; 10 Agnostic Don&#39;t know/refused        96</span></a>
<a class="sourceLine" id="cb14-16" title="16"><span class="co">#&gt; # ... with 170 more rows</span></a></code></pre></div>
<p>This form is tidy because each column represents a variable and each row represents an observation, in this case a demographic unit corresponding to a combination of <code>religion</code> and <code>income</code>.</p>
<p>This format is also used to record regularly spaced observations over time. For example, the Billboard dataset shown below records the date a song first entered the billboard top 100. It has variables for <code>artist</code>, <code>track</code>, <code>date.entered</code>, <code>rank</code> and <code>week</code>. The rank in each week after it enters the top 100 is recorded in 75 columns, <code>wk1</code> to <code>wk75</code>. This form of storage is not tidy, but it is useful for data entry. It reduces duplication since otherwise each song in each week would need its own row, and song metadata like title and artist would need to be repeated. This will be discussed in more depth in <a href="#multiple-types">multiple types</a>.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1">billboard</a>
<a class="sourceLine" id="cb15-2" title="2"><span class="co">#&gt; # A tibble: 317 x 79</span></a>
<a class="sourceLine" id="cb15-3" title="3"><span class="co">#&gt;    artist track date.entered   wk1   wk2   wk3   wk4   wk5   wk6   wk7   wk8</span></a>
<a class="sourceLine" id="cb15-4" title="4"><span class="co">#&gt;    &lt;chr&gt;  &lt;chr&gt; &lt;date&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb15-5" title="5"><span class="co">#&gt;  1 2 Pac  Baby~ 2000-02-26      87    82    72    77    87    94    99    NA</span></a>
<a class="sourceLine" id="cb15-6" title="6"><span class="co">#&gt;  2 2Ge+h~ The ~ 2000-09-02      91    87    92    NA    NA    NA    NA    NA</span></a>
<a class="sourceLine" id="cb15-7" title="7"><span class="co">#&gt;  3 3 Doo~ Kryp~ 2000-04-08      81    70    68    67    66    57    54    53</span></a>
<a class="sourceLine" id="cb15-8" title="8"><span class="co">#&gt;  4 3 Doo~ Loser 2000-10-21      76    76    72    69    67    65    55    59</span></a>
<a class="sourceLine" id="cb15-9" title="9"><span class="co">#&gt;  5 504 B~ Wobb~ 2000-04-15      57    34    25    17    17    31    36    49</span></a>
<a class="sourceLine" id="cb15-10" title="10"><span class="co">#&gt;  6 98^0   Give~ 2000-08-19      51    39    34    26    26    19     2     2</span></a>
<a class="sourceLine" id="cb15-11" title="11"><span class="co">#&gt;  7 A*Tee~ Danc~ 2000-07-08      97    97    96    95   100    NA    NA    NA</span></a>
<a class="sourceLine" id="cb15-12" title="12"><span class="co">#&gt;  8 Aaliy~ I Do~ 2000-01-29      84    62    51    41    38    35    35    38</span></a>
<a class="sourceLine" id="cb15-13" title="13"><span class="co">#&gt;  9 Aaliy~ Try ~ 2000-03-18      59    53    38    28    21    18    16    14</span></a>
<a class="sourceLine" id="cb15-14" title="14"><span class="co">#&gt; 10 Adams~ Open~ 2000-08-26      76    76    74    69    68    67    61    58</span></a>
<a class="sourceLine" id="cb15-15" title="15"><span class="co">#&gt; # ... with 307 more rows, and 68 more variables: wk9 &lt;dbl&gt;, wk10 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb15-16" title="16"><span class="co">#&gt; #   wk11 &lt;dbl&gt;, wk12 &lt;dbl&gt;, wk13 &lt;dbl&gt;, wk14 &lt;dbl&gt;, wk15 &lt;dbl&gt;, wk16 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb15-17" title="17"><span class="co">#&gt; #   wk17 &lt;dbl&gt;, wk18 &lt;dbl&gt;, wk19 &lt;dbl&gt;, wk20 &lt;dbl&gt;, wk21 &lt;dbl&gt;, wk22 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb15-18" title="18"><span class="co">#&gt; #   wk23 &lt;dbl&gt;, wk24 &lt;dbl&gt;, wk25 &lt;dbl&gt;, wk26 &lt;dbl&gt;, wk27 &lt;dbl&gt;, wk28 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb15-19" title="19"><span class="co">#&gt; #   wk29 &lt;dbl&gt;, wk30 &lt;dbl&gt;, wk31 &lt;dbl&gt;, wk32 &lt;dbl&gt;, wk33 &lt;dbl&gt;, wk34 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb15-20" title="20"><span class="co">#&gt; #   wk35 &lt;dbl&gt;, wk36 &lt;dbl&gt;, wk37 &lt;dbl&gt;, wk38 &lt;dbl&gt;, wk39 &lt;dbl&gt;, wk40 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb15-21" title="21"><span class="co">#&gt; #   wk41 &lt;dbl&gt;, wk42 &lt;dbl&gt;, wk43 &lt;dbl&gt;, wk44 &lt;dbl&gt;, wk45 &lt;dbl&gt;, wk46 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb15-22" title="22"><span class="co">#&gt; #   wk47 &lt;dbl&gt;, wk48 &lt;dbl&gt;, wk49 &lt;dbl&gt;, wk50 &lt;dbl&gt;, wk51 &lt;dbl&gt;, wk52 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb15-23" title="23"><span class="co">#&gt; #   wk53 &lt;dbl&gt;, wk54 &lt;dbl&gt;, wk55 &lt;dbl&gt;, wk56 &lt;dbl&gt;, wk57 &lt;dbl&gt;, wk58 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb15-24" title="24"><span class="co">#&gt; #   wk59 &lt;dbl&gt;, wk60 &lt;dbl&gt;, wk61 &lt;dbl&gt;, wk62 &lt;dbl&gt;, wk63 &lt;dbl&gt;, wk64 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb15-25" title="25"><span class="co">#&gt; #   wk65 &lt;dbl&gt;, wk66 &lt;lgl&gt;, wk67 &lt;lgl&gt;, wk68 &lt;lgl&gt;, wk69 &lt;lgl&gt;, wk70 &lt;lgl&gt;,</span></a>
<a class="sourceLine" id="cb15-26" title="26"><span class="co">#&gt; #   wk71 &lt;lgl&gt;, wk72 &lt;lgl&gt;, wk73 &lt;lgl&gt;, wk74 &lt;lgl&gt;, wk75 &lt;lgl&gt;, wk76 &lt;lgl&gt;</span></a></code></pre></div>
<p>To tidy this dataset, we first gather together all the <code>wk</code> columns. The column names give the <code>week</code> and the values are the <code>rank</code>s:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1">billboard2 &lt;-<span class="st"> </span>billboard <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb16-2" title="2"><span class="st">  </span><span class="kw">pivot_longer</span>(</a>
<a class="sourceLine" id="cb16-3" title="3">    wk1<span class="op">:</span>wk76, </a>
<a class="sourceLine" id="cb16-4" title="4">    <span class="dt">names_to =</span> <span class="st">&quot;week&quot;</span>, </a>
<a class="sourceLine" id="cb16-5" title="5">    <span class="dt">values_to =</span> <span class="st">&quot;rank&quot;</span>, </a>
<a class="sourceLine" id="cb16-6" title="6">    <span class="dt">values_drop_na =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb16-7" title="7">  )</a>
<a class="sourceLine" id="cb16-8" title="8">billboard2</a>
<a class="sourceLine" id="cb16-9" title="9"><span class="co">#&gt; # A tibble: 5,307 x 5</span></a>
<a class="sourceLine" id="cb16-10" title="10"><span class="co">#&gt;    artist  track                   date.entered week   rank</span></a>
<a class="sourceLine" id="cb16-11" title="11"><span class="co">#&gt;    &lt;chr&gt;   &lt;chr&gt;                   &lt;date&gt;       &lt;chr&gt; &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb16-12" title="12"><span class="co">#&gt;  1 2 Pac   Baby Don&#39;t Cry (Keep... 2000-02-26   wk1      87</span></a>
<a class="sourceLine" id="cb16-13" title="13"><span class="co">#&gt;  2 2 Pac   Baby Don&#39;t Cry (Keep... 2000-02-26   wk2      82</span></a>
<a class="sourceLine" id="cb16-14" title="14"><span class="co">#&gt;  3 2 Pac   Baby Don&#39;t Cry (Keep... 2000-02-26   wk3      72</span></a>
<a class="sourceLine" id="cb16-15" title="15"><span class="co">#&gt;  4 2 Pac   Baby Don&#39;t Cry (Keep... 2000-02-26   wk4      77</span></a>
<a class="sourceLine" id="cb16-16" title="16"><span class="co">#&gt;  5 2 Pac   Baby Don&#39;t Cry (Keep... 2000-02-26   wk5      87</span></a>
<a class="sourceLine" id="cb16-17" title="17"><span class="co">#&gt;  6 2 Pac   Baby Don&#39;t Cry (Keep... 2000-02-26   wk6      94</span></a>
<a class="sourceLine" id="cb16-18" title="18"><span class="co">#&gt;  7 2 Pac   Baby Don&#39;t Cry (Keep... 2000-02-26   wk7      99</span></a>
<a class="sourceLine" id="cb16-19" title="19"><span class="co">#&gt;  8 2Ge+her The Hardest Part Of ... 2000-09-02   wk1      91</span></a>
<a class="sourceLine" id="cb16-20" title="20"><span class="co">#&gt;  9 2Ge+her The Hardest Part Of ... 2000-09-02   wk2      87</span></a>
<a class="sourceLine" id="cb16-21" title="21"><span class="co">#&gt; 10 2Ge+her The Hardest Part Of ... 2000-09-02   wk3      92</span></a>
<a class="sourceLine" id="cb16-22" title="22"><span class="co">#&gt; # ... with 5,297 more rows</span></a></code></pre></div>
<p>Here we use <code>na.rm</code> to drop any missing values from the gather columns. In this data, missing values represent weeks that the song wasn’t in the charts, so can be safely dropped.</p>
<p>In this case it’s also nice to do a little cleaning, converting the week variable to a number, and figuring out the date corresponding to each week on the charts:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1">billboard3 &lt;-<span class="st"> </span>billboard2 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb17-3" title="3">    <span class="dt">week =</span> <span class="kw">extract_numeric</span>(week),</a>
<a class="sourceLine" id="cb17-4" title="4">    <span class="dt">date =</span> <span class="kw">as.Date</span>(date.entered) <span class="op">+</span><span class="st"> </span><span class="dv">7</span> <span class="op">*</span><span class="st"> </span>(week <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-5" title="5"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>date.entered)</a>
<a class="sourceLine" id="cb17-6" title="6"><span class="co">#&gt; extract_numeric() is deprecated: please use readr::parse_number() instead</span></a>
<a class="sourceLine" id="cb17-7" title="7">billboard3</a>
<a class="sourceLine" id="cb17-8" title="8"><span class="co">#&gt; # A tibble: 5,307 x 5</span></a>
<a class="sourceLine" id="cb17-9" title="9"><span class="co">#&gt;    artist  track                    week  rank date      </span></a>
<a class="sourceLine" id="cb17-10" title="10"><span class="co">#&gt;    &lt;chr&gt;   &lt;chr&gt;                   &lt;dbl&gt; &lt;dbl&gt; &lt;date&gt;    </span></a>
<a class="sourceLine" id="cb17-11" title="11"><span class="co">#&gt;  1 2 Pac   Baby Don&#39;t Cry (Keep...     1    87 2000-02-26</span></a>
<a class="sourceLine" id="cb17-12" title="12"><span class="co">#&gt;  2 2 Pac   Baby Don&#39;t Cry (Keep...     2    82 2000-03-04</span></a>
<a class="sourceLine" id="cb17-13" title="13"><span class="co">#&gt;  3 2 Pac   Baby Don&#39;t Cry (Keep...     3    72 2000-03-11</span></a>
<a class="sourceLine" id="cb17-14" title="14"><span class="co">#&gt;  4 2 Pac   Baby Don&#39;t Cry (Keep...     4    77 2000-03-18</span></a>
<a class="sourceLine" id="cb17-15" title="15"><span class="co">#&gt;  5 2 Pac   Baby Don&#39;t Cry (Keep...     5    87 2000-03-25</span></a>
<a class="sourceLine" id="cb17-16" title="16"><span class="co">#&gt;  6 2 Pac   Baby Don&#39;t Cry (Keep...     6    94 2000-04-01</span></a>
<a class="sourceLine" id="cb17-17" title="17"><span class="co">#&gt;  7 2 Pac   Baby Don&#39;t Cry (Keep...     7    99 2000-04-08</span></a>
<a class="sourceLine" id="cb17-18" title="18"><span class="co">#&gt;  8 2Ge+her The Hardest Part Of ...     1    91 2000-09-02</span></a>
<a class="sourceLine" id="cb17-19" title="19"><span class="co">#&gt;  9 2Ge+her The Hardest Part Of ...     2    87 2000-09-09</span></a>
<a class="sourceLine" id="cb17-20" title="20"><span class="co">#&gt; 10 2Ge+her The Hardest Part Of ...     3    92 2000-09-16</span></a>
<a class="sourceLine" id="cb17-21" title="21"><span class="co">#&gt; # ... with 5,297 more rows</span></a></code></pre></div>
<p>Finally, it’s always a good idea to sort the data. We could do it by artist, track and week:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1">billboard3 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(artist, track, week)</a>
<a class="sourceLine" id="cb18-2" title="2"><span class="co">#&gt; # A tibble: 5,307 x 5</span></a>
<a class="sourceLine" id="cb18-3" title="3"><span class="co">#&gt;    artist  track                    week  rank date      </span></a>
<a class="sourceLine" id="cb18-4" title="4"><span class="co">#&gt;    &lt;chr&gt;   &lt;chr&gt;                   &lt;dbl&gt; &lt;dbl&gt; &lt;date&gt;    </span></a>
<a class="sourceLine" id="cb18-5" title="5"><span class="co">#&gt;  1 2 Pac   Baby Don&#39;t Cry (Keep...     1    87 2000-02-26</span></a>
<a class="sourceLine" id="cb18-6" title="6"><span class="co">#&gt;  2 2 Pac   Baby Don&#39;t Cry (Keep...     2    82 2000-03-04</span></a>
<a class="sourceLine" id="cb18-7" title="7"><span class="co">#&gt;  3 2 Pac   Baby Don&#39;t Cry (Keep...     3    72 2000-03-11</span></a>
<a class="sourceLine" id="cb18-8" title="8"><span class="co">#&gt;  4 2 Pac   Baby Don&#39;t Cry (Keep...     4    77 2000-03-18</span></a>
<a class="sourceLine" id="cb18-9" title="9"><span class="co">#&gt;  5 2 Pac   Baby Don&#39;t Cry (Keep...     5    87 2000-03-25</span></a>
<a class="sourceLine" id="cb18-10" title="10"><span class="co">#&gt;  6 2 Pac   Baby Don&#39;t Cry (Keep...     6    94 2000-04-01</span></a>
<a class="sourceLine" id="cb18-11" title="11"><span class="co">#&gt;  7 2 Pac   Baby Don&#39;t Cry (Keep...     7    99 2000-04-08</span></a>
<a class="sourceLine" id="cb18-12" title="12"><span class="co">#&gt;  8 2Ge+her The Hardest Part Of ...     1    91 2000-09-02</span></a>
<a class="sourceLine" id="cb18-13" title="13"><span class="co">#&gt;  9 2Ge+her The Hardest Part Of ...     2    87 2000-09-09</span></a>
<a class="sourceLine" id="cb18-14" title="14"><span class="co">#&gt; 10 2Ge+her The Hardest Part Of ...     3    92 2000-09-16</span></a>
<a class="sourceLine" id="cb18-15" title="15"><span class="co">#&gt; # ... with 5,297 more rows</span></a></code></pre></div>
<p>Or by date and rank:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" title="1">billboard3 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(date, rank)</a>
<a class="sourceLine" id="cb19-2" title="2"><span class="co">#&gt; # A tibble: 5,307 x 5</span></a>
<a class="sourceLine" id="cb19-3" title="3"><span class="co">#&gt;    artist   track   week  rank date      </span></a>
<a class="sourceLine" id="cb19-4" title="4"><span class="co">#&gt;    &lt;chr&gt;    &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;date&gt;    </span></a>
<a class="sourceLine" id="cb19-5" title="5"><span class="co">#&gt;  1 Lonestar Amazed     1    81 1999-06-05</span></a>
<a class="sourceLine" id="cb19-6" title="6"><span class="co">#&gt;  2 Lonestar Amazed     2    54 1999-06-12</span></a>
<a class="sourceLine" id="cb19-7" title="7"><span class="co">#&gt;  3 Lonestar Amazed     3    44 1999-06-19</span></a>
<a class="sourceLine" id="cb19-8" title="8"><span class="co">#&gt;  4 Lonestar Amazed     4    39 1999-06-26</span></a>
<a class="sourceLine" id="cb19-9" title="9"><span class="co">#&gt;  5 Lonestar Amazed     5    38 1999-07-03</span></a>
<a class="sourceLine" id="cb19-10" title="10"><span class="co">#&gt;  6 Lonestar Amazed     6    33 1999-07-10</span></a>
<a class="sourceLine" id="cb19-11" title="11"><span class="co">#&gt;  7 Lonestar Amazed     7    29 1999-07-17</span></a>
<a class="sourceLine" id="cb19-12" title="12"><span class="co">#&gt;  8 Amber    Sexual     1    99 1999-07-17</span></a>
<a class="sourceLine" id="cb19-13" title="13"><span class="co">#&gt;  9 Lonestar Amazed     8    29 1999-07-24</span></a>
<a class="sourceLine" id="cb19-14" title="14"><span class="co">#&gt; 10 Amber    Sexual     2    99 1999-07-24</span></a>
<a class="sourceLine" id="cb19-15" title="15"><span class="co">#&gt; # ... with 5,297 more rows</span></a></code></pre></div>
</div>
<div id="multiple-variables-stored-in-one-column" class="section level2">
<h2>Multiple variables stored in one column</h2>
<p>After gathering columns, the key column is sometimes a combination of multiple underlying variable names. This happens in the <code>tb</code> (tuberculosis) dataset, shown below. This dataset comes from the World Health Organisation, and records the counts of confirmed tuberculosis cases by <code>country</code>, <code>year</code>, and demographic group. The demographic groups are broken down by <code>sex</code> (m, f) and <code>age</code> (0-14, 15-25, 25-34, 35-44, 45-54, 55-64, unknown).</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" title="1"><span class="kw">library</span>(tidyr)</a>
<a class="sourceLine" id="cb20-2" title="2"><span class="kw">library</span>(stringr)</a>
<a class="sourceLine" id="cb20-3" title="3"><span class="co">#&gt; Warning: package &#39;stringr&#39; was built under R version 4.0.2</span></a>
<a class="sourceLine" id="cb20-4" title="4">tb &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(<span class="kw">read.csv</span>(<span class="st">&quot;tb.csv&quot;</span>, <span class="dt">na.strings=</span><span class="st">&quot;&quot;</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>))</a>
<a class="sourceLine" id="cb20-5" title="5"><span class="kw">names</span>(tb) &lt;-<span class="st"> </span><span class="kw">str_replace</span>(<span class="kw">names</span>(tb),<span class="st">&quot;new_sp_&quot;</span>,<span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb20-6" title="6"></a>
<a class="sourceLine" id="cb20-7" title="7">tb<span class="op">$</span>new_sp &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb20-8" title="8"><span class="kw">names</span>(tb)[<span class="dv">1</span>] &lt;-<span class="st"> &quot;country&quot;</span></a>
<a class="sourceLine" id="cb20-9" title="9"><span class="kw">head</span>(tb)</a>
<a class="sourceLine" id="cb20-10" title="10"><span class="co">#&gt; # A tibble: 6 x 22</span></a>
<a class="sourceLine" id="cb20-11" title="11"><span class="co">#&gt;   country  year   m04  m514  m014 m1524 m2534 m3544 m4554 m5564   m65    mu</span></a>
<a class="sourceLine" id="cb20-12" title="12"><span class="co">#&gt;   &lt;chr&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;</span></a>
<a class="sourceLine" id="cb20-13" title="13"><span class="co">#&gt; 1 AD       1989    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA</span></a>
<a class="sourceLine" id="cb20-14" title="14"><span class="co">#&gt; 2 AD       1990    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA</span></a>
<a class="sourceLine" id="cb20-15" title="15"><span class="co">#&gt; 3 AD       1991    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA</span></a>
<a class="sourceLine" id="cb20-16" title="16"><span class="co">#&gt; 4 AD       1992    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA</span></a>
<a class="sourceLine" id="cb20-17" title="17"><span class="co">#&gt; 5 AD       1993    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA</span></a>
<a class="sourceLine" id="cb20-18" title="18"><span class="co">#&gt; 6 AD       1994    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA</span></a>
<a class="sourceLine" id="cb20-19" title="19"><span class="co">#&gt; # ... with 10 more variables: f04 &lt;int&gt;, f514 &lt;int&gt;, f014 &lt;int&gt;, f1524 &lt;int&gt;,</span></a>
<a class="sourceLine" id="cb20-20" title="20"><span class="co">#&gt; #   f2534 &lt;int&gt;, f3544 &lt;int&gt;, f4554 &lt;int&gt;, f5564 &lt;int&gt;, f65 &lt;int&gt;, fu &lt;int&gt;</span></a></code></pre></div>
<p>Use pivot_longer() to gather up the non-variable columns:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" title="1">tb2 &lt;-<span class="st"> </span>tb <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb21-2" title="2"><span class="st">  </span><span class="kw">pivot_longer</span>(</a>
<a class="sourceLine" id="cb21-3" title="3">    <span class="op">!</span><span class="kw">c</span>(country, year), </a>
<a class="sourceLine" id="cb21-4" title="4">    <span class="dt">names_to =</span> <span class="st">&quot;demo&quot;</span>, </a>
<a class="sourceLine" id="cb21-5" title="5">    <span class="dt">values_to =</span> <span class="st">&quot;n&quot;</span>, </a>
<a class="sourceLine" id="cb21-6" title="6">    <span class="dt">values_drop_na =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb21-7" title="7">  )</a>
<a class="sourceLine" id="cb21-8" title="8"><span class="kw">head</span>(tb2)</a>
<a class="sourceLine" id="cb21-9" title="9"><span class="co">#&gt; # A tibble: 6 x 4</span></a>
<a class="sourceLine" id="cb21-10" title="10"><span class="co">#&gt;   country  year demo      n</span></a>
<a class="sourceLine" id="cb21-11" title="11"><span class="co">#&gt;   &lt;chr&gt;   &lt;int&gt; &lt;chr&gt; &lt;int&gt;</span></a>
<a class="sourceLine" id="cb21-12" title="12"><span class="co">#&gt; 1 AD       1996 m014      0</span></a>
<a class="sourceLine" id="cb21-13" title="13"><span class="co">#&gt; 2 AD       1996 m1524     0</span></a>
<a class="sourceLine" id="cb21-14" title="14"><span class="co">#&gt; 3 AD       1996 m2534     0</span></a>
<a class="sourceLine" id="cb21-15" title="15"><span class="co">#&gt; 4 AD       1996 m3544     4</span></a>
<a class="sourceLine" id="cb21-16" title="16"><span class="co">#&gt; 5 AD       1996 m4554     1</span></a>
<a class="sourceLine" id="cb21-17" title="17"><span class="co">#&gt; 6 AD       1996 m5564     0</span></a></code></pre></div>
<p>Split into gender and age columns</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" title="1">tb3 &lt;-<span class="st"> </span>tb2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb22-2" title="2"><span class="st">  </span><span class="kw">separate</span>(demo, <span class="kw">c</span>(<span class="st">&quot;sex&quot;</span>, <span class="st">&quot;age&quot;</span>), <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb22-3" title="3"><span class="kw">head</span>(tb3)</a>
<a class="sourceLine" id="cb22-4" title="4"><span class="co">#&gt; # A tibble: 6 x 5</span></a>
<a class="sourceLine" id="cb22-5" title="5"><span class="co">#&gt;   country  year sex   age       n</span></a>
<a class="sourceLine" id="cb22-6" title="6"><span class="co">#&gt;   &lt;chr&gt;   &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt;</span></a>
<a class="sourceLine" id="cb22-7" title="7"><span class="co">#&gt; 1 AD       1996 m     014       0</span></a>
<a class="sourceLine" id="cb22-8" title="8"><span class="co">#&gt; 2 AD       1996 m     1524      0</span></a>
<a class="sourceLine" id="cb22-9" title="9"><span class="co">#&gt; 3 AD       1996 m     2534      0</span></a>
<a class="sourceLine" id="cb22-10" title="10"><span class="co">#&gt; 4 AD       1996 m     3544      4</span></a>
<a class="sourceLine" id="cb22-11" title="11"><span class="co">#&gt; 5 AD       1996 m     4554      1</span></a>
<a class="sourceLine" id="cb22-12" title="12"><span class="co">#&gt; 6 AD       1996 m     5564      0</span></a></code></pre></div>
<p>Alternatively, we could have combined the above steps</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" title="1">tb <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pivot_longer</span>(</a>
<a class="sourceLine" id="cb23-2" title="2">  <span class="op">!</span><span class="kw">c</span>(country, year), </a>
<a class="sourceLine" id="cb23-3" title="3">  <span class="dt">names_to =</span> <span class="kw">c</span>(<span class="st">&quot;sex&quot;</span>, <span class="st">&quot;age&quot;</span>), </a>
<a class="sourceLine" id="cb23-4" title="4">  <span class="dt">names_pattern =</span> <span class="st">&quot;(.)(.+)&quot;</span>,</a>
<a class="sourceLine" id="cb23-5" title="5">  <span class="dt">values_to =</span> <span class="st">&quot;n&quot;</span>, </a>
<a class="sourceLine" id="cb23-6" title="6">  <span class="dt">values_drop_na =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb23-7" title="7">)</a>
<a class="sourceLine" id="cb23-8" title="8"><span class="co">#&gt; # A tibble: 35,750 x 5</span></a>
<a class="sourceLine" id="cb23-9" title="9"><span class="co">#&gt;    country  year sex   age       n</span></a>
<a class="sourceLine" id="cb23-10" title="10"><span class="co">#&gt;    &lt;chr&gt;   &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt;</span></a>
<a class="sourceLine" id="cb23-11" title="11"><span class="co">#&gt;  1 AD       1996 m     014       0</span></a>
<a class="sourceLine" id="cb23-12" title="12"><span class="co">#&gt;  2 AD       1996 m     1524      0</span></a>
<a class="sourceLine" id="cb23-13" title="13"><span class="co">#&gt;  3 AD       1996 m     2534      0</span></a>
<a class="sourceLine" id="cb23-14" title="14"><span class="co">#&gt;  4 AD       1996 m     3544      4</span></a>
<a class="sourceLine" id="cb23-15" title="15"><span class="co">#&gt;  5 AD       1996 m     4554      1</span></a>
<a class="sourceLine" id="cb23-16" title="16"><span class="co">#&gt;  6 AD       1996 m     5564      0</span></a>
<a class="sourceLine" id="cb23-17" title="17"><span class="co">#&gt;  7 AD       1996 m     65        0</span></a>
<a class="sourceLine" id="cb23-18" title="18"><span class="co">#&gt;  8 AD       1996 f     014       0</span></a>
<a class="sourceLine" id="cb23-19" title="19"><span class="co">#&gt;  9 AD       1996 f     1524      1</span></a>
<a class="sourceLine" id="cb23-20" title="20"><span class="co">#&gt; 10 AD       1996 f     2534      1</span></a>
<a class="sourceLine" id="cb23-21" title="21"><span class="co">#&gt; # ... with 35,740 more rows</span></a></code></pre></div>
<p>Storing the values in this form resolves a problem in the original data. We want to compare rates, not counts, which means we need to know the population. In the original format, there is no easy way to add a population variable. It has to be stored in a separate table, which makes it hard to correctly match populations to counts. In tidy form, adding variables for population and rate is easy because they’re just additional columns.</p>
</div>
<div id="variables-are-stored-in-both-rows-and-columns" class="section level2">
<h2>Variables are stored in both rows and columns</h2>
<p>The most complicated form of messy data occurs when variables are stored in both rows and columns. The code below loads daily weather data from the Global Historical Climatology Network for one weather station (MX17004) in Mexico for five months in 2010.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" title="1">weather &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(<span class="kw">read.csv</span>(<span class="st">&quot;weather.csv&quot;</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>))</a>
<a class="sourceLine" id="cb24-2" title="2">weather</a>
<a class="sourceLine" id="cb24-3" title="3"><span class="co">#&gt; # A tibble: 22 x 36</span></a>
<a class="sourceLine" id="cb24-4" title="4"><span class="co">#&gt;        X id     year month element    d1    d2    d3    d4    d5    d6    d7</span></a>
<a class="sourceLine" id="cb24-5" title="5"><span class="co">#&gt;    &lt;int&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb24-6" title="6"><span class="co">#&gt;  1     1 MX17~  2010     1 tmax       NA  NA    NA      NA  NA      NA    NA</span></a>
<a class="sourceLine" id="cb24-7" title="7"><span class="co">#&gt;  2     2 MX17~  2010     1 tmin       NA  NA    NA      NA  NA      NA    NA</span></a>
<a class="sourceLine" id="cb24-8" title="8"><span class="co">#&gt;  3     3 MX17~  2010     2 tmax       NA  27.3  24.1    NA  NA      NA    NA</span></a>
<a class="sourceLine" id="cb24-9" title="9"><span class="co">#&gt;  4     4 MX17~  2010     2 tmin       NA  14.4  14.4    NA  NA      NA    NA</span></a>
<a class="sourceLine" id="cb24-10" title="10"><span class="co">#&gt;  5     5 MX17~  2010     3 tmax       NA  NA    NA      NA  32.1    NA    NA</span></a>
<a class="sourceLine" id="cb24-11" title="11"><span class="co">#&gt;  6     6 MX17~  2010     3 tmin       NA  NA    NA      NA  14.2    NA    NA</span></a>
<a class="sourceLine" id="cb24-12" title="12"><span class="co">#&gt;  7     7 MX17~  2010     4 tmax       NA  NA    NA      NA  NA      NA    NA</span></a>
<a class="sourceLine" id="cb24-13" title="13"><span class="co">#&gt;  8     8 MX17~  2010     4 tmin       NA  NA    NA      NA  NA      NA    NA</span></a>
<a class="sourceLine" id="cb24-14" title="14"><span class="co">#&gt;  9     9 MX17~  2010     5 tmax       NA  NA    NA      NA  NA      NA    NA</span></a>
<a class="sourceLine" id="cb24-15" title="15"><span class="co">#&gt; 10    10 MX17~  2010     5 tmin       NA  NA    NA      NA  NA      NA    NA</span></a>
<a class="sourceLine" id="cb24-16" title="16"><span class="co">#&gt; # ... with 12 more rows, and 24 more variables: d8 &lt;dbl&gt;, d9 &lt;lgl&gt;, d10 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb24-17" title="17"><span class="co">#&gt; #   d11 &lt;dbl&gt;, d12 &lt;lgl&gt;, d13 &lt;dbl&gt;, d14 &lt;dbl&gt;, d15 &lt;dbl&gt;, d16 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb24-18" title="18"><span class="co">#&gt; #   d17 &lt;dbl&gt;, d18 &lt;lgl&gt;, d19 &lt;lgl&gt;, d20 &lt;lgl&gt;, d21 &lt;lgl&gt;, d22 &lt;lgl&gt;,</span></a>
<a class="sourceLine" id="cb24-19" title="19"><span class="co">#&gt; #   d23 &lt;dbl&gt;, d24 &lt;lgl&gt;, d25 &lt;dbl&gt;, d26 &lt;dbl&gt;, d27 &lt;dbl&gt;, d28 &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb24-20" title="20"><span class="co">#&gt; #   d29 &lt;dbl&gt;, d30 &lt;dbl&gt;, d31 &lt;dbl&gt;</span></a></code></pre></div>
<p>It has variables in individual columns (<code>id</code>, <code>year</code>, <code>month</code>), spread across columns (<code>day</code>, d1-d31) and across rows (<code>tmin</code>, <code>tmax</code>) (minimum and maximum temperature). Months with fewer than 31 days have structural missing values for the last day(s) of the month.</p>
<p>To tidy this dataset we first gather the day columns by using pivot_longer:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" title="1">weather2 &lt;-<span class="st"> </span>weather <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb25-2" title="2"><span class="st">  </span><span class="kw">pivot_longer</span>(</a>
<a class="sourceLine" id="cb25-3" title="3">    d1<span class="op">:</span>d31, </a>
<a class="sourceLine" id="cb25-4" title="4">    <span class="dt">names_to =</span> <span class="st">&quot;day&quot;</span>, </a>
<a class="sourceLine" id="cb25-5" title="5">    <span class="dt">values_to =</span> <span class="st">&quot;value&quot;</span>, </a>
<a class="sourceLine" id="cb25-6" title="6">    <span class="dt">values_drop_na =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb25-7" title="7">  ) </a>
<a class="sourceLine" id="cb25-8" title="8">weather2</a>
<a class="sourceLine" id="cb25-9" title="9"><span class="co">#&gt; # A tibble: 66 x 7</span></a>
<a class="sourceLine" id="cb25-10" title="10"><span class="co">#&gt;        X id       year month element day   value</span></a>
<a class="sourceLine" id="cb25-11" title="11"><span class="co">#&gt;    &lt;int&gt; &lt;chr&gt;   &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;chr&gt; &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb25-12" title="12"><span class="co">#&gt;  1     1 MX17004  2010     1 tmax    d30    27.8</span></a>
<a class="sourceLine" id="cb25-13" title="13"><span class="co">#&gt;  2     2 MX17004  2010     1 tmin    d30    14.5</span></a>
<a class="sourceLine" id="cb25-14" title="14"><span class="co">#&gt;  3     3 MX17004  2010     2 tmax    d2     27.3</span></a>
<a class="sourceLine" id="cb25-15" title="15"><span class="co">#&gt;  4     3 MX17004  2010     2 tmax    d3     24.1</span></a>
<a class="sourceLine" id="cb25-16" title="16"><span class="co">#&gt;  5     3 MX17004  2010     2 tmax    d11    29.7</span></a>
<a class="sourceLine" id="cb25-17" title="17"><span class="co">#&gt;  6     3 MX17004  2010     2 tmax    d23    29.9</span></a>
<a class="sourceLine" id="cb25-18" title="18"><span class="co">#&gt;  7     4 MX17004  2010     2 tmin    d2     14.4</span></a>
<a class="sourceLine" id="cb25-19" title="19"><span class="co">#&gt;  8     4 MX17004  2010     2 tmin    d3     14.4</span></a>
<a class="sourceLine" id="cb25-20" title="20"><span class="co">#&gt;  9     4 MX17004  2010     2 tmin    d11    13.4</span></a>
<a class="sourceLine" id="cb25-21" title="21"><span class="co">#&gt; 10     4 MX17004  2010     2 tmin    d23    10.7</span></a>
<a class="sourceLine" id="cb25-22" title="22"><span class="co">#&gt; # ... with 56 more rows</span></a></code></pre></div>
<p>For presentation, I’ve dropped the missing values, making them implicit rather than explicit. This is ok because we know how many days are in each month and can easily reconstruct the explicit missing values.</p>
<p>We’ll also do a little cleaning:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" title="1">weather3 &lt;-<span class="st"> </span>weather2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb26-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">day =</span> <span class="kw">as.integer</span>(<span class="kw">gsub</span>(<span class="st">&quot;d&quot;</span>, <span class="st">&quot;&quot;</span>, day))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb26-3" title="3"><span class="st">  </span><span class="kw">select</span>(id, year, month, day, element, value)</a>
<a class="sourceLine" id="cb26-4" title="4">weather3</a>
<a class="sourceLine" id="cb26-5" title="5"><span class="co">#&gt; # A tibble: 66 x 6</span></a>
<a class="sourceLine" id="cb26-6" title="6"><span class="co">#&gt;    id       year month   day element value</span></a>
<a class="sourceLine" id="cb26-7" title="7"><span class="co">#&gt;    &lt;chr&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb26-8" title="8"><span class="co">#&gt;  1 MX17004  2010     1    30 tmax     27.8</span></a>
<a class="sourceLine" id="cb26-9" title="9"><span class="co">#&gt;  2 MX17004  2010     1    30 tmin     14.5</span></a>
<a class="sourceLine" id="cb26-10" title="10"><span class="co">#&gt;  3 MX17004  2010     2     2 tmax     27.3</span></a>
<a class="sourceLine" id="cb26-11" title="11"><span class="co">#&gt;  4 MX17004  2010     2     3 tmax     24.1</span></a>
<a class="sourceLine" id="cb26-12" title="12"><span class="co">#&gt;  5 MX17004  2010     2    11 tmax     29.7</span></a>
<a class="sourceLine" id="cb26-13" title="13"><span class="co">#&gt;  6 MX17004  2010     2    23 tmax     29.9</span></a>
<a class="sourceLine" id="cb26-14" title="14"><span class="co">#&gt;  7 MX17004  2010     2     2 tmin     14.4</span></a>
<a class="sourceLine" id="cb26-15" title="15"><span class="co">#&gt;  8 MX17004  2010     2     3 tmin     14.4</span></a>
<a class="sourceLine" id="cb26-16" title="16"><span class="co">#&gt;  9 MX17004  2010     2    11 tmin     13.4</span></a>
<a class="sourceLine" id="cb26-17" title="17"><span class="co">#&gt; 10 MX17004  2010     2    23 tmin     10.7</span></a>
<a class="sourceLine" id="cb26-18" title="18"><span class="co">#&gt; # ... with 56 more rows</span></a></code></pre></div>
<p>This dataset is mostly tidy, but the <code>element</code> column is not a variable; it stores the names of variables. (Not shown in this example are the other meteorological variables <code>prcp</code> (precipitation) and <code>snow</code> (snowfall)). Fixing this requires the spread operation. This performs the inverse of gathering by spreading the <code>element</code> and <code>value</code> columns back out into the columns:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" title="1">weather3 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb27-2" title="2"><span class="st">  </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> element, <span class="dt">values_from =</span> value)</a>
<a class="sourceLine" id="cb27-3" title="3"><span class="co">#&gt; # A tibble: 33 x 6</span></a>
<a class="sourceLine" id="cb27-4" title="4"><span class="co">#&gt;    id       year month   day  tmax  tmin</span></a>
<a class="sourceLine" id="cb27-5" title="5"><span class="co">#&gt;    &lt;chr&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb27-6" title="6"><span class="co">#&gt;  1 MX17004  2010     1    30  27.8  14.5</span></a>
<a class="sourceLine" id="cb27-7" title="7"><span class="co">#&gt;  2 MX17004  2010     2     2  27.3  14.4</span></a>
<a class="sourceLine" id="cb27-8" title="8"><span class="co">#&gt;  3 MX17004  2010     2     3  24.1  14.4</span></a>
<a class="sourceLine" id="cb27-9" title="9"><span class="co">#&gt;  4 MX17004  2010     2    11  29.7  13.4</span></a>
<a class="sourceLine" id="cb27-10" title="10"><span class="co">#&gt;  5 MX17004  2010     2    23  29.9  10.7</span></a>
<a class="sourceLine" id="cb27-11" title="11"><span class="co">#&gt;  6 MX17004  2010     3     5  32.1  14.2</span></a>
<a class="sourceLine" id="cb27-12" title="12"><span class="co">#&gt;  7 MX17004  2010     3    10  34.5  16.8</span></a>
<a class="sourceLine" id="cb27-13" title="13"><span class="co">#&gt;  8 MX17004  2010     3    16  31.1  17.6</span></a>
<a class="sourceLine" id="cb27-14" title="14"><span class="co">#&gt;  9 MX17004  2010     4    27  36.3  16.7</span></a>
<a class="sourceLine" id="cb27-15" title="15"><span class="co">#&gt; 10 MX17004  2010     5    27  33.2  18.2</span></a>
<a class="sourceLine" id="cb27-16" title="16"><span class="co">#&gt; # ... with 23 more rows</span></a></code></pre></div>
<p>This form is tidy: there’s one variable in each column, and each row represents one day.</p>
</div>
<div id="multiple-types" class="section level2">
<h2>Multiple types in one table</h2>
<p>Datasets often involve values collected at multiple levels, on different types of observational units. During tidying, each type of observational unit should be stored in its own table. This is closely related to the idea of database normalisation, where each fact is expressed in only one place. It’s important because otherwise inconsistencies can arise.</p>
<p>The billboard dataset actually contains observations on two types of observational units: the song and its rank in each week. This manifests itself through the duplication of facts about the song: <code>artist</code> is repeated many times.</p>
<p>This dataset needs to be broken down into two pieces: a song dataset which stores <code>artist</code> and <code>song name</code>, and a ranking dataset which gives the <code>rank</code> of the <code>song</code> in each <code>week</code>. We first extract a <code>song</code> dataset:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" title="1">song &lt;-<span class="st"> </span>billboard3 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb28-2" title="2"><span class="st"> </span><span class="kw">distinct</span>(artist, track) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb28-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">song_id =</span> <span class="kw">row_number</span>())</a>
<a class="sourceLine" id="cb28-4" title="4">song</a>
<a class="sourceLine" id="cb28-5" title="5"><span class="co">#&gt; # A tibble: 317 x 3</span></a>
<a class="sourceLine" id="cb28-6" title="6"><span class="co">#&gt;    artist         track                   song_id</span></a>
<a class="sourceLine" id="cb28-7" title="7"><span class="co">#&gt;    &lt;chr&gt;          &lt;chr&gt;                     &lt;int&gt;</span></a>
<a class="sourceLine" id="cb28-8" title="8"><span class="co">#&gt;  1 2 Pac          Baby Don&#39;t Cry (Keep...       1</span></a>
<a class="sourceLine" id="cb28-9" title="9"><span class="co">#&gt;  2 2Ge+her        The Hardest Part Of ...       2</span></a>
<a class="sourceLine" id="cb28-10" title="10"><span class="co">#&gt;  3 3 Doors Down   Kryptonite                    3</span></a>
<a class="sourceLine" id="cb28-11" title="11"><span class="co">#&gt;  4 3 Doors Down   Loser                         4</span></a>
<a class="sourceLine" id="cb28-12" title="12"><span class="co">#&gt;  5 504 Boyz       Wobble Wobble                 5</span></a>
<a class="sourceLine" id="cb28-13" title="13"><span class="co">#&gt;  6 98^0           Give Me Just One Nig...       6</span></a>
<a class="sourceLine" id="cb28-14" title="14"><span class="co">#&gt;  7 A*Teens        Dancing Queen                 7</span></a>
<a class="sourceLine" id="cb28-15" title="15"><span class="co">#&gt;  8 Aaliyah        I Don&#39;t Wanna                 8</span></a>
<a class="sourceLine" id="cb28-16" title="16"><span class="co">#&gt;  9 Aaliyah        Try Again                     9</span></a>
<a class="sourceLine" id="cb28-17" title="17"><span class="co">#&gt; 10 Adams, Yolanda Open My Heart                10</span></a>
<a class="sourceLine" id="cb28-18" title="18"><span class="co">#&gt; # ... with 307 more rows</span></a></code></pre></div>
<p>Then use that to make a <code>rank</code> dataset by replacing repeated song facts with a pointer to song details (a unique song id):</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" title="1">rank &lt;-<span class="st"> </span>billboard3 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb29-2" title="2"><span class="st">  </span><span class="kw">left_join</span>(song, <span class="kw">c</span>(<span class="st">&quot;artist&quot;</span>, <span class="st">&quot;track&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb29-3" title="3"><span class="st">  </span><span class="kw">select</span>(song_id, date, week, rank) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb29-4" title="4"><span class="st">  </span><span class="kw">arrange</span>(song_id, date)</a>
<a class="sourceLine" id="cb29-5" title="5">rank</a>
<a class="sourceLine" id="cb29-6" title="6"><span class="co">#&gt; # A tibble: 5,307 x 4</span></a>
<a class="sourceLine" id="cb29-7" title="7"><span class="co">#&gt;    song_id date        week  rank</span></a>
<a class="sourceLine" id="cb29-8" title="8"><span class="co">#&gt;      &lt;int&gt; &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb29-9" title="9"><span class="co">#&gt;  1       1 2000-02-26     1    87</span></a>
<a class="sourceLine" id="cb29-10" title="10"><span class="co">#&gt;  2       1 2000-03-04     2    82</span></a>
<a class="sourceLine" id="cb29-11" title="11"><span class="co">#&gt;  3       1 2000-03-11     3    72</span></a>
<a class="sourceLine" id="cb29-12" title="12"><span class="co">#&gt;  4       1 2000-03-18     4    77</span></a>
<a class="sourceLine" id="cb29-13" title="13"><span class="co">#&gt;  5       1 2000-03-25     5    87</span></a>
<a class="sourceLine" id="cb29-14" title="14"><span class="co">#&gt;  6       1 2000-04-01     6    94</span></a>
<a class="sourceLine" id="cb29-15" title="15"><span class="co">#&gt;  7       1 2000-04-08     7    99</span></a>
<a class="sourceLine" id="cb29-16" title="16"><span class="co">#&gt;  8       2 2000-09-02     1    91</span></a>
<a class="sourceLine" id="cb29-17" title="17"><span class="co">#&gt;  9       2 2000-09-09     2    87</span></a>
<a class="sourceLine" id="cb29-18" title="18"><span class="co">#&gt; 10       2 2000-09-16     3    92</span></a>
<a class="sourceLine" id="cb29-19" title="19"><span class="co">#&gt; # ... with 5,297 more rows</span></a></code></pre></div>
<p>You could also imagine a <code>week</code> dataset which would record background information about the week, maybe the total number of songs sold or similar “demographic” information.</p>
<p>Normalisation is useful for tidying and eliminating inconsistencies. However, there are few data analysis tools that work directly with relational data, so analysis usually also requires denormalisation or the merging the datasets back into one table.</p>
</div>
<div id="one-type-in-multiple-tables" class="section level2">
<h2>One type in multiple tables</h2>
<p>It’s also common to find data values about a single type of observational unit spread out over multiple tables or files. These tables and files are often split up by another variable, so that each represents a single year, person, or location. As long as the format for individual records is consistent, this is an easy problem to fix:</p>
<ol style="list-style-type: decimal">
<li><p>Read the files into a list of tables.</p></li>
<li><p>For each table, add a new column that records the original file name (the file name is often the value of an important variable).</p></li>
<li><p>Combine all tables into a single table.</p></li>
</ol>
<p>Purrr makes this straightforward in R. The following code generates a vector of file names in a directory (<code>data/</code>) which match a regular expression (ends in <code>.csv</code>). Next we name each element of the vector with the name of the file. We do this because will preserve the names in the following step, ensuring that each row in the final data frame is labeled with its source. Finally, <code>map_dfr()</code> loops over each path, reading in the csv file and combining the results into a single data frame.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" title="1"><span class="kw">library</span>(purrr)</a>
<a class="sourceLine" id="cb30-2" title="2">paths &lt;-<span class="st"> </span><span class="kw">dir</span>(<span class="st">&quot;data&quot;</span>, <span class="dt">pattern =</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">.csv$&quot;</span>, <span class="dt">full.names =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb30-3" title="3"><span class="kw">names</span>(paths) &lt;-<span class="st"> </span><span class="kw">basename</span>(paths)</a>
<a class="sourceLine" id="cb30-4" title="4"><span class="kw">map_dfr</span>(paths, read.csv, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>, <span class="dt">.id =</span> <span class="st">&quot;filename&quot;</span>)</a></code></pre></div>
<p>Once you have a single table, you can perform additional tidying as needed. An example of this type of cleaning can be found at <a href="https://github.com/hadley/data-baby-names" class="uri">https://github.com/hadley/data-baby-names</a> which takes 129 yearly baby name tables provided by the US Social Security Administration and combines them into a single file.</p>
<p>A more complicated situation occurs when the dataset structure changes over time. For example, the datasets may contain different variables, the same variables with different names, different file formats, or different conventions for missing values. This may require you to tidy each file to individually (or, if you’re lucky, in small groups) and then combine them once tidied. An example of this type of tidying is illustrated in <a href="https://github.com/hadley/data-fuel-economy" class="uri">https://github.com/hadley/data-fuel-economy</a>, which shows the tidying of <span>epa</span> fuel economy data for over 50,000 cars from 1978 to 2008. The raw data is available online, but each year is stored in a separate file and there are four major formats with many minor variations, making tidying this dataset a considerable challenge.</p>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
